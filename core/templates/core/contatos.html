{% extends 'base.html' %}
{% load static %}
{% load query_tags %}

{% block content %}

<!-- ================================== -->
<!-- SEÇÃO HERO - Banner Principal     -->
<!-- ================================== -->
<section class="hero-section py-5">
    <div class="hero-overlay"></div>
    <div class="container py-4">
        <div class="row align-items-center">
            <div class="col-lg-8 mx-auto text-center">
                <!-- REMOVIDO: classes de animação antigas -->
                <h1 class="fw-bold display-5 mb-3">
                    Rede de Apoio Especializada em Autismo
                </h1>
                <p class="lead mb-4">
                    Conecte-se com profissionais, instituições e grupos de apoio dedicados ao atendimento e suporte para
                    pessoas com TEA e suas famílias.
                </p>
                <div class="d-flex justify-content-center gap-3">
                    <a href="#contatos-section" class="btn btn-light btn-lg px-4">
                        <i class="fas fa-address-book me-2"></i>Ver contatos
                    </a>
                    <a href="#filtro-section" class="btn btn-outline-light btn-lg px-4">
                        <i class="fas fa-filter me-2"></i>Filtrar
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================================== -->
<!-- SEÇÃO FILTROS - REESTILIZADA     -->
<!-- ================================== -->
<!-- ADICIONADO: classe .fade-in-section -->
<section id="filtro-section" class="py-5 bg-light fade-in-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-9">
                <div class="filter-card">
                    <div class="filter-card-header">
                        <h5 class="mb-0"><i class="fas fa-filter me-2 text-primary"></i>Encontre o apoio que você precisa</h5>
                        <button id="btn-limpar-filtros" class="btn-reset">
                            <i class="fas fa-times me-2"></i>Limpar Filtros
                        </button>
                    </div>
                    <div class="filter-card-body">
                        <div class="row g-3 align-items-center">
                            <div class="col-md-4">
                                <label for="filtro-categoria" class="form-label">Tipo de contato</label>
                                <select id="filtro-categoria" class="form-select">
                                    <option value="todos" selected>Todas as categorias</option>
                                    {% for categoria in todas_categorias %}
                                    <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="filtro-atendimento" class="form-label">Atendimento</label>
                                <select id="filtro-atendimento" class="form-select">
                                    <option value="todos" selected>Todos</option>
                                    <option value="presencial">Presencial</option>
                                    <option value="online">Online</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="filtro-localizacao" class="form-label">Localização (Estado)</label>
                                <input type="text" id="filtro-localizacao" class="form-control" placeholder="Digite a sigla do estado (Ex: SP)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ========================================================== -->
<!--     FILTROS DE CATEGORIA (VERSÃO CARROSSEL COM SETAS)      -->
<!-- ========================================================== -->
{% if categorias_com_pagina %}
    <!-- ADICIONADO: classe .fade-in-section -->
    <div class="category-carousel-wrapper fade-in-section">
        <div class="category-filters-container">
            <div class="category-filters">
                {% for item in categorias_com_pagina %}
                    <a href="#{{ item.categoria.nome|lower|slugify }}" 
                       class="btn-category-filter"
                       data-target-page="{{ item.pagina }}"
                       data-current-page="{{ page_obj.number }}">
                        <i class="{{ item.categoria.icone }} me-2"></i>
                        <span>{{ item.categoria.nome }}</span>
                    </a>
                {% endfor %}
            </div>
        </div>
        <button type="button" class="carousel-arrow prev" aria-label="Anterior">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button type="button" class="carousel-arrow next" aria-label="Próximo">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
{% endif %}
<!-- ========================================================== -->

<!-- ================================== -->
<!-- SEÇÃO CONTATOS - Lista principal  -->
<!-- ================================== -->
<section id="contatos-section" class="py-5">
    <div class="container">
        <!-- ADICIONADO: classe .fade-in-section -->
        <div class="row mb-5 fade-in-section">
            <div class="col-lg-8 mx-auto text-center">
                <div class="section-subtitle">Nossa rede de apoio</div>
                <h2 class="section-title">Contatos Especializados</h2>
                <div class="section-divider"></div>
                <p class="section-description">
                    Uma rede completa de profissionais, instituições e serviços especializados no atendimento
                    de pessoas com Transtorno do Espectro Autista e suporte às suas famílias.
                </p>
            </div>
        </div>

        {% if contatos_por_categoria_paginada %}
            {% for categoria, dados in contatos_por_categoria_paginada.items %}
                {% with contatos_page_obj=dados.contatos_page_obj query_param_name=dados.query_param_name %}
                    {% if contatos_page_obj %}
                        <!-- ADICIONADO: classe .fade-in-section em cada categoria -->
                        <div class="contato-category mb-5 fade-in-section" id="{{ categoria.nome|lower|slugify }}">
                            <div class="category-header">
                                <div class="category-icon">
                                    <i class="{{ categoria.icone }} text-primary fs-3"></i>
                                </div>
                                <h3 class="mb-0">{{ categoria.nome }}</h3>
                            </div>
                            <div class="row g-4">
                                {% for contato in contatos_page_obj %}
                                    <!-- A animação agora vem do pai (.contato-category) -->
                                    <div class="col-md-6 col-lg-4 contato-item">
                                        <div class="card h-100 border-0 shadow-sm hover-card">
                                            <div class="card-img-top position-relative">
                                                {% if contato.imagem_url %}
                                                    <img src="{{ contato.imagem_url }}" alt="{{ contato.nome }}" class="img-fluid rounded-top" style="height: 200px; width: 100%; object-fit: cover;">
                                                {% else %}
                                                    <img src="{% static 'img/default-contact.jpg' %}" alt="{{ contato.nome }}" class="img-fluid rounded-top" style="height: 200px; width: 100%; object-fit: cover;">
                                                {% endif %}
                                                
                                                {% if user.is_authenticated %}
                                                    {% if contato.id in contatos_salvos_ids %}
                                                        <button type="button" class="btn btn-save-contact saved" data-contato-id="{{ contato.id }}" onclick="removerContato({{ contato.id }})" title="Remover dos salvos"><i class="fas fa-bookmark"></i></button>
                                                    {% else %}
                                                        <button type="button" class="btn btn-save-contact" data-contato-id="{{ contato.id }}" onclick="salvarContato({{ contato.id }})" title="Salvar contato"><i class="far fa-bookmark"></i></button>
                                                    {% endif %}
                                                {% else %}
                                                    <button type="button" class="btn btn-save-contact" onclick="showLoginRequired()" title="Faça login para salvar"><i class="far fa-bookmark"></i></button>
                                                {% endif %}

                                                <div class="position-absolute bottom-0 start-0 p-3">
                                                    <span class="badge bg-primary">{{ contato.categoria.nome }}</span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-3"><h5 class="card-title mb-0">{{ contato.nome }}</h5></div>
                                                <p class="card-text text-muted mb-3">{{ contato.descricao|truncatechars:80 }}</p>
                                                <div class="contact-info-item mb-2">
                                                    <div class="contact-info-icon"><i class="fas fa-map-marker-alt text-primary"></i></div>
                                                    <small>
                                                        {% if contato.rua %}{{ contato.rua }}{% if contato.numero %}, {{ contato.numero }}{% endif %}{% if contato.bairro %} - {{ contato.bairro }}{% endif %}<br>{% endif %}
                                                        {{ contato.cidade }}, {{ contato.estado }}{% if contato.cep %}<br>CEP: {{ contato.cep }}{% endif %}
                                                    </small>
                                                </div>
                                                <div class="contact-info-item mb-2">
                                                    <div class="contact-info-icon"><i class="fas fa-phone text-primary"></i></div>
                                                    <small>{{ contato.telefone }}</small>
                                                </div>
                                                <div class="contact-info-item mb-3">
                                                    <div class="contact-info-icon"><i class="fas fa-clock text-primary"></i></div>
                                                    <small>{{ contato.horario_funcionamento }}</small>
                                                </div>
                                                <div class="card-action-area">
                                                    <div class="mb-3">
                                                        {% if contato.atendimento_presencial %}<span class="badge bg-success me-1"><i class="fas fa-building me-1"></i>Presencial</span>{% endif %}
                                                        {% if contato.atendimento_online %}<span class="badge bg-info"><i class="fas fa-laptop me-1"></i>Online</span>{% endif %}
                                                    </div>
                                                    <div class="d-flex gap-2 flex-wrap"><a href="{% url 'detalhes_contato' contato.id %}" class="btn btn-sm btn-outline-primary flex-fill"><i class="fas fa-eye me-1"></i>Ver detalhes</a></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            {% if contatos_page_obj.paginator.num_pages > 1 %}
                            <nav aria-label="Navegação de contatos para {{ categoria.nome }}" class="mt-4">
                                <ul class="pagination pagination-sm justify-content-center">
                                    {% if contatos_page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?{% build_query query_param_name contatos_page_obj.previous_page_number %}">&laquo;</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&laquo;</a></li>
                                    {% endif %}
                                    {% for i in contatos_page_obj.paginator.page_range %}
                                        {% if contatos_page_obj.number == i %}
                                            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                                        {% else %}
                                            <li class="page-item"><a class="page-link" href="?{% build_query query_param_name i %}">{{ i }}</a></li>
                                        {% endif %}
                                    {% endfor %}
                                    {% if contatos_page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?{% build_query query_param_name contatos_page_obj.next_page_number %}">&raquo;</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&raquo;</a></li>
                                    {% endif %}
                                </ul>
                            </nav>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}

            {% if page_obj.has_other_pages %}
            <!-- ADICIONADO: classe .fade-in-section -->
            <nav aria-label="Navegação das páginas de categorias" class="mt-5 fade-in-section">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.previous_page_number %}">&laquo; Categorias Anteriores</a>
                        </li>
                    {% endif %}
                    <li class="page-item main-pagination-item disabled">
                        <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
                    </li>
                    {% if page_obj.has_next %}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.next_page_number %}">Próximas Categorias &raquo;</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

        {% else %}
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <!-- ADICIONADO: classe .fade-in-section -->
                    <div class="alert alert-info p-4 shadow-sm rounded-3 fade-in-section">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>Nenhum contato encontrado</h4>
                        <p class="mb-0">
                            Não há contatos cadastrados no momento. Entre em contato com o administrador para mais informações.
                        </p>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- ADICIONADO: classe .fade-in-section -->
        <div class="row mt-5 fade-in-section">
            <div class="col-lg-8 mx-auto">
                <div class="card cta-card border-0 shadow">
                    <div class="card-body p-5 text-center text-white">
                        <h4 class="mb-3">Conhece algum profissional ou instituição especializada?</h4>
                        <p class="mb-4">Ajude a ampliar nossa rede de apoio indicando contatos que possam auxiliar famílias e pessoas com TEA.</p>
                        <button type="button" class="btn cta-btn" data-bs-toggle="modal" data-bs-target="#sugerirContatoModal"><i class="fas fa-plus-circle me-2"></i>Sugerir contato</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- MODAL DE LOGIN -->
<div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content login-modal-content">
            <div class="modal-header border-0 pb-0">
                <button type="button" class="btn-close-modern" data-bs-dismiss="modal" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body px-4 pb-4">
                <div class="text-center">
                    <div class="login-icon-wrapper mb-4">
                        <div class="login-icon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                    </div>
                    <h3 class="login-title mb-3" id="loginModalLabel">
                        Acesse sua conta
                    </h3>
                    <p class="login-description mb-4">
                        Para salvar suas dúvidas favoritas e personalizar sua experiência, 
                        faça login ou crie uma conta gratuita.
                    </p>
                    <div class="benefits-list mb-4">
                        <div class="benefit-item">
                            <i class="fas fa-bookmark"></i>
                            <span>Salve dúvidas favoritas</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-history"></i>
                            <span>Histórico personalizado</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-sync"></i>
                            <span>Sincronize dispositivos</span>
                        </div>
                    </div>
                    <div class="login-actions d-grid gap-3 mb-3">
                        <a href="{% url 'login' %}" class="btn btn-primary btn-lg btn-login">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            Entrar
                        </a>
                        <a href="{% url 'register' %}" class="btn btn-outline-primary btn-lg btn-register">
                            <i class="fas fa-user-plus me-2"></i>
                            Criar conta grátis
                        </a>
                    </div>
                    <div class="login-footer">
                        <button type="button" class="btn-link-modern" data-bs-dismiss="modal">
                            <i class="fas fa-arrow-left me-1"></i>
                            Continuar sem salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- =============================================================================
   CONTAINER DE NOTIFICAÇÕES (TOAST MODERNO)
   ============================================================================= -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div id="notificationToast" class="toast modern-toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body p-0">
            <div class="d-flex">
                <!-- Barra lateral colorida com ícone -->
                <div class="toast-icon-area d-flex align-items-center justify-content-center">
                    <i id="toastIcon" class="fas fa-check-circle"></i>
                </div>

                <!-- Conteúdo da mensagem -->
                <div class="toast-content-area p-3">
                    <h6 id="toastTitle" class="toast-title mb-1">Sucesso!</h6>
                    <p id="toastBody" class="toast-message mb-0">
                        O contato foi salvo com sucesso.
                    </p>
                </div>
                
                <!-- Botão de fechar -->
                <button type="button" class="btn-close-toast" data-bs-dismiss="toast" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- =============================================================================
   MODAL PARA SUGERIR CONTATO
   ============================================================================= -->
<div class="modal fade" id="sugerirContatoModal" tabindex="-1" aria-labelledby="sugerirContatoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sugerirContatoModalLabel">
                    <i class="fas fa-plus-circle me-2"></i>Sugerir Novo Contato
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form id="sugestaoForm" action="{% url 'sugerir_contato' %}" method="POST">
                    {% csrf_token %}
                    <p class="form-description">
                        Agradecemos sua colaboração! Preencha os campos abaixo com as informações que você conhece. Nossa equipe revisará a sugestão.
                    </p>

                    <div class="row g-3">
                        <!-- Informações Essenciais -->
                        <div class="col-12">
                            <label for="sugestao-nome" class="form-label">Nome do Local ou Profissional <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="sugestao-nome" name="nome" placeholder="Ex: Clínica Crescer, Dr. João Silva" required>
                        </div>
                        <div class="col-12">
                            <label for="sugestao-categoria" class="form-label">Categoria <span class="text-danger">*</span></label>
                            <select class="form-select" id="sugestao-categoria" name="categoria" required>
                                <option value="" disabled selected>Selecione a principal área de atuação</option>
                                {% for categoria in todas_categorias %}
                                    <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Contato -->
                        <div class="col-md-6">
                            <label for="sugestao-telefone" class="form-label">Telefone <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="sugestao-telefone" name="telefone" placeholder="(00) 0000-0000" required>
                        </div>
                        <div class="col-md-6">
                            <label for="sugestao-whatsapp" class="form-label">WhatsApp (Opcional)</label>
                            <input type="tel" class="form-control" id="sugestao-whatsapp" name="whatsapp" placeholder="(00) 90000-0000">
                        </div>
                         <div class="col-md-6">
                            <label for="sugestao-email" class="form-label">E-mail (Opcional)</label>
                            <input type="email" class="form-control" id="sugestao-email" name="email" placeholder="contato@exemplo.com">
                        </div>
                        <div class="col-md-6">
                            <label for="sugestao-site" class="form-label">Site ou Rede Social (Opcional)</label>
                            <input type="url" class="form-control" id="sugestao-site" name="site" placeholder="https://www.instagram.com/perfil">
                        </div>

                        <!-- Endereço -->
                        <div class="form-section-divider">
                            <span>Localização</span>
                        </div>
                        <div class="col-md-6">
                            <label for="sugestao-cidade" class="form-label">Cidade <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="sugestao-cidade" name="cidade" required>
                        </div>
                        <div class="col-md-6">
                            <label for="sugestao-estado" class="form-label">Estado <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="sugestao-estado" name="estado" placeholder="Sigla, ex: SP" required>
                        </div>
                        <div class="col-12">
                            <label for="sugestao-endereco" class="form-label">Endereço (Rua, Bairro - Opcional)</label>
                            <input type="text" class="form-control" id="sugestao-endereco" name="rua" placeholder="Rua das Flores, 123 - Centro">
                        </div>

                        <!-- Detalhes Adicionais -->
                        <div class="form-section-divider">
                            <span>Detalhes Adicionais</span>
                        </div>
                         <div class="col-12">
                            <label class="form-label">Tipo de Atendimento</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check custom-checkbox">
                                    <input class="form-check-input" type="checkbox" value="True" id="sugestao-presencial" name="atendimento_presencial" checked>
                                    <label class="form-check-label" for="sugestao-presencial">
                                        <i class="fas fa-building"></i> Presencial
                                    </label>
                                </div>
                                <div class="form-check custom-checkbox">
                                    <input class="form-check-input" type="checkbox" value="True" id="sugestao-online" name="atendimento_online">
                                    <label class="form-check-label" for="sugestao-online">
                                        <i class="fas fa-laptop"></i> Online
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="sugestao-observacoes" class="form-label">Observações (Opcional)</label>
                            <textarea class="form-control" id="sugestao-observacoes" name="observacoes" rows="3" placeholder="Algo mais que devamos saber? (Especialidades, convênios, etc.)"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary" form="sugestaoForm">
                    <i class="fas fa-paper-plane me-2"></i>Enviar Sugestão
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // =============================================================================
    // DECLARAÇÃO DAS FUNÇÕES PRINCIPAIS
    // =============================================================================

    /**
     * Salva um contato para o usuário logado.
     */
    function salvarContato(contatoId, element) {
        const csrfToken = getCookie('csrftoken');
        fetch(`/salvar-contato/${contatoId}/`, {
            method: 'POST',
            headers: { 'X-CSRFToken': csrfToken, 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateSaveButton(contatoId, true);
                showToast('Contato Salvo!', 'Adicionado à sua lista de favoritos.', 'success');
            } else {
                showToast('Ops!', data.message || 'Ocorreu um erro.', 'error');
            }
        })
        .catch(error => showToast('Erro de Rede', 'Não foi possível salvar o contato.', 'error'));
    }

    /**
     * Remove um contato salvo do usuário.
     */
    function removerContato(contatoId, element) {
        const csrfToken = getCookie('csrftoken');
        fetch(`/remover-contato/${contatoId}/`, {
            method: 'POST',
            headers: { 'X-CSRFToken': csrfToken, 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateSaveButton(contatoId, false);
                showToast('Contato Removido', 'Retirado da sua lista de favoritos.', 'info');
            } else {
                showToast('Ops!', data.message || 'Ocorreu um erro.', 'error');
            }
        })
        .catch(error => showToast('Erro de Rede', 'Não foi possível remover o contato.', 'error'));
    }
    
    /**
     * Atualiza a aparência e a função do botão de salvar.
     */
    function updateSaveButton(contatoId, isSaved) {
        const button = document.querySelector(`button[data-contato-id="${contatoId}"]`);
        if (button) {
            const icon = button.querySelector('i');
            if (isSaved) {
                button.classList.add('saved');
                icon.classList.replace('far', 'fas');
                button.setAttribute('onclick', `removerContato(${contatoId}, this)`);
                button.title = 'Remover dos salvos';
            } else {
                button.classList.remove('saved');
                icon.classList.replace('fas', 'far');
                button.setAttribute('onclick', `salvarContato(${contatoId}, this)`);
                button.title = 'Salvar contato';
            }
        }
    }

    /**
     * Exibe o modal de login quando uma ação requer autenticação.
     */
    function showLoginRequired() {
        const modalElement = document.getElementById('loginModal');
        if (modalElement) {
            const loginModalInstance = new bootstrap.Modal(modalElement);
            loginModalInstance.show();
        } else if (confirm('Você precisa estar logado para salvar contatos.\nDeseja ir para a página de login?')) {
            window.location.href = '{% url "login" %}';
        }
    }

    /**
     * Exibe uma notificação toast moderna e customizada.
     */
    function showToast(title, message, type = 'info') {
        const toastElement = document.getElementById('notificationToast');
        if (!toastElement) return;
        
        const toast = new bootstrap.Toast(toastElement, { delay: 5000 });
        const toastIconArea = toastElement.querySelector('.toast-icon-area');
        const toastIcon = toastElement.querySelector('#toastIcon');
        const toastTitle = toastElement.querySelector('#toastTitle');
        const toastBody = toastElement.querySelector('#toastBody');

        const configs = {
            success: { icon: 'fa-check-circle', colorClass: 'toast-success', defaultTitle: 'Sucesso!' },
            error: { icon: 'fa-times-circle', colorClass: 'toast-error', defaultTitle: 'Erro!' },
            info: { icon: 'fa-info-circle', colorClass: 'toast-info', defaultTitle: 'Informação' },
            warning: { icon: 'fa-exclamation-triangle', colorClass: 'toast-warning', defaultTitle: 'Atenção!' }
        };
        const config = configs[type] || configs.info;
        
        toastTitle.textContent = title || config.defaultTitle;
        toastBody.textContent = message;
        toastIcon.className = `fas ${config.icon}`;
        toastIconArea.className = 'toast-icon-area d-flex align-items-center justify-content-center ' + config.colorClass;

        toastElement.classList.remove('hide');
        toast.show();
    }

    /**
     * Lógica para os filtros de contato (versão vanilla JS).
     */
    function initContactFilters() {
        const categoriaSelect = document.getElementById('filtro-categoria');
        const atendimentoSelect = document.getElementById('filtro-atendimento');
        const localizacaoInput = document.getElementById('filtro-localizacao');
        const limparBtn = document.getElementById('btn-limpar-filtros');
        let searchTimeout;

        function applyFilters() {
            const params = new URLSearchParams(window.location.search);
            // Atualiza ou remove parâmetros conforme o valor do filtro
            if (categoriaSelect.value !== 'todos') params.set('categoria', categoriaSelect.value); else params.delete('categoria');
            if (atendimentoSelect.value !== 'todos') params.set('atendimento', atendimentoSelect.value); else params.delete('atendimento');
            if (localizacaoInput.value.trim()) params.set('localizacao', localizacaoInput.value.trim()); else params.delete('localizacao');
            
            // Navega para a nova URL
            window.location.href = `{% url 'contatos' %}?${params.toString()}`;
        }
        
        [categoriaSelect, atendimentoSelect].forEach(el => el.addEventListener('change', applyFilters));

        localizacaoInput.addEventListener('keyup', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 600);
        });

        limparBtn.addEventListener('click', () => {
            window.location.href = `{% url 'contatos' %}`;
        });
    }

    /**
     * Adiciona rolagem suave para os filtros de categoria com lógica de paginação.
     */
    function initCategoryFilterScrolling() {
        document.querySelectorAll('.btn-category-filter').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetPage = parseInt(this.dataset.targetPage, 10);
                const currentPage = parseInt(this.dataset.currentPage, 10);
                const targetId = this.getAttribute('href');

                if (targetPage === currentPage) {
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 120; // Mais espaço
                        window.scrollTo({ top: offsetTop, behavior: 'smooth' });
                    }
                } else {
                    const newUrl = `{% url 'contatos' %}?page=${targetPage}${targetId}`;
                    window.location.href = newUrl;
                }
            });
        });
    }

    /**
     * Rola suavemente para uma âncora na URL (#) após o carregamento da página.
     */
    function smoothScrollToHashOnLoad() {
        setTimeout(() => {
            if (window.location.hash) {
                const targetElement = document.querySelector(window.location.hash);
                if (targetElement) {
                    const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 120;
                    window.scrollTo({ top: offsetTop, behavior: 'smooth' });
                }
            }
        }, 200);
    }
    
    /**
     * Inicializa os controles de seta para o carrossel de categorias.
     */
    function initCategoryCarouselControls() {
        const wrapper = document.querySelector('.category-carousel-wrapper');
        if (!wrapper) return;

        const container = wrapper.querySelector('.category-filters-container');
        const prevBtn = wrapper.querySelector('.carousel-arrow.prev');
        const nextBtn = wrapper.querySelector('.carousel-arrow.next');

        if (container.scrollWidth <= container.clientWidth) {
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            return;
        }

        const scrollAmount = 300;
        const updateArrowVisibility = () => {
            const tolerance = 5; 
            prevBtn.classList.toggle('hidden', container.scrollLeft < tolerance);
            const isAtEnd = container.scrollLeft + container.clientWidth >= container.scrollWidth - tolerance;
            nextBtn.classList.toggle('hidden', isAtEnd);
        };

        prevBtn.addEventListener('click', () => container.scrollBy({ left: -scrollAmount, behavior: 'smooth' }));
        nextBtn.addEventListener('click', () => container.scrollBy({ left: scrollAmount, behavior: 'smooth' }));
        container.addEventListener('scroll', updateArrowVisibility);
        updateArrowVisibility();
    }
    
    /**
     * Função para obter o valor do cookie CSRF.
     */
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }


    // =============================================================================
    // INICIALIZAÇÃO DA PÁGINA
    // =============================================================================
    document.addEventListener('DOMContentLoaded', function () {
        // Inicializa todas as funcionalidades da página
        initContactFilters();
        initCategoryFilterScrolling();
        smoothScrollToHashOnLoad();
        initCategoryCarouselControls();
    });

</script>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>
<style>
    /*
===============================================================================
ESTRUTURA GERAL DO CSS
===============================================================================
1. Variáveis CSS
2. Componentes Base
3. Cards de Contato
4. Botões
5. Notificações Toast
6. Navegação e Cabeçalhos
7. Modal de Login
8. Animações
9. Responsividade
===============================================================================
*/

/* 
===============================================================================
1. VARIÁVEIS CSS
===============================================================================
*/
:root {
    --primary: #6A3EA1;
    --gradient-modern: linear-gradient(45deg, #6A3EA1, #8E44AD);
    --shadow-modern: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
    --border-radius-lg: 20px;
    --border-radius-md: 15px;
    --border-radius-sm: 12px;
    --border-radius-full: 50px;
    --transition-smooth: all 0.3s ease;
    --transition-bounce: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* 
===============================================================================
2. CARDS DE CONTATO
===============================================================================
*/
.hover-card {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    transition: var(--transition-bounce);
    position: relative;
    z-index: 1;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
}

.hover-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(106, 62, 161, 0.15);
}

.hover-card:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
    z-index: 2;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease;
}

.hover-card:hover:before {
    transform: scaleX(1);
}

.hover-card .card-img-top {
    transition: all 0.5s ease;
}

.hover-card:hover .card-img-top {
    transform: scale(1.05);
}

.hover-card .card-body {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 1.5rem;
}

.card-action-area {
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Informações de Contato */
.contact-info-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.8rem;
    position: relative;
    padding-left: 2rem;
}

.contact-info-icon {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    color: var(--primary);
    transition: var(--transition-smooth);
}

.hover-card:hover .contact-info-icon {
    transform: translateY(-50%) scale(1.2);
}

/* 
===============================================================================
3. SISTEMA DE BOTÕES
===============================================================================
*/

/* Botão Salvar Contato */
.btn-save-contact {
    position: absolute;
    top: 15px;
    right: 15px;
    background: transparent;
    border: none;
    padding: 5px;
    cursor: pointer;
    z-index: 5;
    transition: transform 0.3s ease;
}

.btn-save-contact > i {
    font-size: 1.6rem;
    color: white;
    text-shadow: 0 1px 5px rgba(0, 0, 0, 0.6);
    transition: var(--transition-smooth);
}

.btn-save-contact:hover {
    transform: scale(1.2);
}

.btn-save-contact.saved > i {
    color: var(--primary);
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Botão Detalhes Moderno */
.btn-details-modern {
    display: inline-block;
    padding: 0.6rem 1.5rem;
    border-radius: var(--border-radius-full);
    font-weight: 600;
    font-size: 0.8rem;
    color: white;
    text-align: center;
    text-decoration: none;
    border: none;
    background: var(--gradient-modern);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.25);
    transition: var(--transition-smooth);
}

.btn-details-modern:hover {
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(106, 62, 161, 0.4);
}

/* Botões CTA */
.cta-btn {
    background-color: white;
    color: var(--primary);
    font-weight: 600;
    padding: 0.8rem 2rem;
    border-radius: var(--border-radius-full);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transition: var(--transition-smooth);
}

.cta-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

/* 
===============================================================================
4. NOTIFICAÇÕES TOAST (VERSÃO APRIMORADA)
===============================================================================
*/
/* Container principal para posicionamento */
.toast-container {
    z-index: 9999 !important; /* Garante que o toast fique acima de tudo */
}

/* Corpo do Toast Moderno */
.modern-toast {
    position: relative; /* <-- A CORREÇÃO ESTÁ AQUI */
    width: 380px;
    max-width: 95%;
    background-color: #fff;
    border-radius: var(--border-radius-md); /* Borda mais suave */
    border: none;
    box-shadow: 0 15px 40px -10px rgba(0, 0, 0, 0.2); /* Sombra mais pronunciada */
    overflow: hidden;
    /* Adiciona uma borda sutil na parte inferior */
    border-bottom: 4px solid transparent; 
    transition: all 0.4s ease-in-out;
}

/* Variações de Cor (aplicadas na borda inferior) */
.modern-toast .toast-success { border-bottom-color: #28a745; }
.modern-toast .toast-error { border-bottom-color: #dc3545; }
.modern-toast .toast-info { border-bottom-color: #0dcaf0; }
.modern-toast .toast-warning { border-bottom-color: #ffc107; }


.toast-body {
    padding: 0 !important; /* Removemos o padding padrão */
}

/* Área do Ícone Colorida */
.toast-icon-area {
    flex: 0 0 60px; /* Um pouco maior para mais destaque */
    color: #fff;
    font-size: 1.8rem; /* Ícone maior */
    transition: background-color 0.3s ease;
    border-top-left-radius: var(--border-radius-md);
}

/* Variações de Cor da Área do Ícone */
.toast-icon-area.toast-success { background: linear-gradient(135deg, #28a745, #218838); }
.toast-icon-area.toast-error { background: linear-gradient(135deg, #dc3545, #c82333); }
.toast-icon-area.toast-info { background: linear-gradient(135deg, #17a2b8, #138496); }
.toast-icon-area.toast-warning { background: linear-gradient(135deg, #ffc107, #e0a800); }


/* Área de Conteúdo do Toast */
.toast-content-area {
    flex-grow: 1;
    padding: 1rem 1.2rem; /* Espaçamento interno generoso */
}

.toast-title {
    font-weight: 700;
    font-size: 1.1rem; /* Título mais proeminente */
    color: #343a40;
    margin-bottom: 0.25rem;
}

.toast-message {
    font-size: 0.95rem;
    color: #6c757d;
    line-height: 1.5;
}

/* Botão de Fechar Moderno */
.btn-close-toast {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: #adb5bd;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-smooth);
}

.btn-close-toast:hover {
    background-color: #f1f3f5;
    color: #495057;
    transform: rotate(90deg) scale(1.1);
}

/* 
===============================================================================
5. NAVEGAÇÃO E CABEÇALHOS
===============================================================================
*/

/* Navegação de Contatos */
.contact-nav {
    margin-bottom: 2rem;
    padding: 0.8rem;
}

.contact-nav .btn {
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: all 0.4s ease;
    border-radius: var(--border-radius-lg);
}

.contact-nav .btn:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: all 0.6s ease;
    z-index: -1;
}

.contact-nav .btn:hover:before {
    left: 100%;
}

/* Cabeçalhos de Categoria */
.category-header {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius-md);
    margin-bottom: 1.5rem;
    transform: translateY(0);
    transition: var(--transition-smooth);
}

.category-header:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(106, 62, 161, 0.15);
}

.category-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.15);
    margin-right: 1.5rem;
}

/* Cards CTA */
.cta-card {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    position: relative;
    z-index: 1;
    /* 
       A MÁGICA ACONTECE AQUI:
       1. A primeira imagem é o padrão de bolinhas.
       2. A segunda é o seu gradiente roxo que fica por baixo.
    */
    background: 
        url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='rgba(255,255,255,0.1)' fill-rule='evenodd'/%3E%3C/svg%3E"),
        var(--gradient-modern);
}

/* 
===============================================================================
6. MODAL DE LOGIN
===============================================================================
*/

/* Backdrop */
.modal-backdrop.show {
    backdrop-filter: blur(10px);
    background-color: rgba(0, 0, 0, 0.3);
}

/* Modal Principal */
.login-modal .modal-dialog {
    max-width: 440px;
    margin: 1rem auto;
}

.login-modal-content {
    border: 2px solid #ccc;
    border-radius: 24px;
    box-shadow: var(--shadow-modern);
    background: white;
    overflow: hidden;
}

.login-modal .modal-header {
    position: relative;
    padding: 1rem 1rem 0;
}

/* Botão de Fechar Modal */
.btn-close-modern {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    cursor: pointer;
    transition: var(--transition-smooth);
    z-index: 10;
}

.btn-close-modern:hover {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    transform: rotate(90deg);
}

/* Ícone de Login */
.login-icon-wrapper {
    position: relative;
}

.login-icon {
    width: 70px;
    height: 70px;
    background: var(--gradient-modern);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    animation: pulse-modern 2s infinite;
}

.login-icon i {
    font-size: 1.8rem;
    color: white;
}

/* Textos do Modal */
.login-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.login-description {
    font-size: 1rem;
    color: #6c757d;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

/* Lista de Benefícios */
.benefits-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-bottom: 2rem;
}

.benefit-item {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 1rem;
    background: rgba(106, 62, 161, 0.05);
    border-radius: 16px;
    transition: var(--transition-smooth);
}

.benefit-item:hover {
    background: rgba(106, 62, 161, 0.1);
    transform: translateX(5px);
}

.benefit-item i {
    color: var(--primary);
    margin-right: 12px;
    width: 16px;
    font-size: 0.9rem;
}

.benefit-item span {
    font-size: 0.9rem;
    color: #495057;
    font-weight: 500;
}

/* Rodapé do Modal */
.login-footer {
    border-top: 1px solid #e9ecef;
    padding-top: 1rem;
}

.btn-link-modern {
    background: none;
    border: none;
    color: #6c757d;
    font-size: 0.9rem;
    cursor: pointer;
    transition: var(--transition-smooth);
    padding: 0.5rem 1rem;
    border-radius: 30px;
}

.btn-link-modern:hover {
    color: var(--primary);
    background: rgba(106, 62, 161, 0.05);
}


/* 
===============================================================================
8. RESPONSIVIDADE
===============================================================================
*/

/* Dispositivos Móveis */
@media (max-width: 576px) {
    .login-modal .modal-dialog {
        margin: 1rem;
        max-width: none;
    }
    
    .modal-body {
        padding: 1.5rem !important;
    }
    
    .login-icon {
        width: 60px;
        height: 60px;
    }
    
    .login-icon i {
        font-size: 1.5rem;
    }
    
    .login-title {
        font-size: 1.3rem;
    }
    
    .login-description {
        font-size: 0.9rem;
    }
    
    .benefit-item {
        padding: 0.4rem 0.8rem;
    }
    
    .benefit-item span {
        font-size: 0.85rem;
    }
    
    .btn-login,
    .btn-register {
        padding: 10px 20px;
        font-size: 0.9rem;
    }
}

/* Tablets */
@media (min-width: 577px) and (max-width: 768px) {
    .modern-toast {
        width: 340px;
    }
    
    .category-header {
        padding: 0.8rem 1.2rem;
    }
    
    .category-icon {
        width: 50px;
        height: 50px;
        margin-right: 1rem;
    }
}

@media (max-width: 768px) {
    
    /* Seleciona o container que envolve os botões de "Filtrar" e "Limpar" */
    #filtro-section .col-12.text-end {
        /* Converte o container em flexbox para controlar o alinhamento */
        display: flex;
        
        /* Empilha os botões verticalmente */
        flex-direction: column;
        
        /* Centraliza os botões na horizontal */
        align-items: center;
        
        /* Cria o espaçamento vertical entre os botões */
        gap: 12px;
        
        /* Adiciona um espaço acima do primeiro botão para separá-lo dos selects */
        margin-top: 1rem;
    }

    /* Faz os botões ocuparem uma largura agradável e consistente */
    #filtro-section #btnFiltrar,
    #filtro-section #btnLimpar {
        width: 100%;
        max-width: 350px; /* Define uma largura máxima para não ficarem esticados demais */
        margin: 0; /* Remove qualquer margem lateral que possa existir */
    }
}

/* Desktop Grande */
@media (min-width: 1200px) {
    .hover-card:hover {
        transform: translateY(-15px);
    }
    
    .category-header:hover {
        transform: translateY(-8px);
    }
}

/*
=============================================================================
8. CORREÇÃO DE PAGINAÇÃO (VERSÃO FINAL CORRIGIDA E RESPONSIVA)
=============================================================================
*/

/* --- A. ESTILOS GERAIS DO CONTAINER --- */
.pagination {
    display: flex;
    flex-wrap: wrap; /* Permite que os botões quebrem a linha em telas médias */
    justify-content: center;
    gap: 8px; /* Espaçamento entre todos os botões */
    list-style: none;
    padding-left: 0;
}

.pagination .page-item {
    margin: 0 !important; /* Remove margens padrão para usar 'gap' */
}

/* --- B. ESTILOS PARA PAGINAÇÃO NUMÉRICA (CÍRCULOS) --- */
/* A regra :not(.main-pagination-item) é a chave!
   Ela aplica estes estilos apenas aos botões que NÃO são da paginação de texto. */
.pagination .page-item:not(.main-pagination-item) .page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: 50%; /* Perfeitamente circular */
    font-weight: 600;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

/* Hover para botões numéricos */
.pagination .page-item:not(.main-pagination-item):not(.active):not(.disabled) .page-link:hover {
    transform: translateY(-3px);
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.15);
}

/* Estilo ATIVO para botões numéricos */
.pagination .page-item:not(.main-pagination-item).active .page-link {
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.3);
    transform: scale(1.05); /* Efeito de destaque */
}

/* --- C. ESTILOS PARA PAGINAÇÃO DE TEXTO (PÍLULAS) --- */
/* Estilo base que anula qualquer conflito com os estilos circulares */
.main-pagination-item .page-link {
    display: inline-block;
    width: auto;
    height: auto;
    border-radius: 50px; /* Formato de pílula */
    padding: 0.5rem 1.2rem;
    white-space: nowrap;
    font-weight: 500;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

/* Efeito de hover específico para as pílulas */
.page-item.main-pagination-item:not(.disabled) .page-link:hover {
    transform: translateY(-2px);
    border-color: var(--primary);
    background-color: var(--primary);
    color: #fff;
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.2);
}

/* Garante que o item ativo ou desabilitado da paginação de texto não tenha escala */
.main-pagination-item.active .page-link,
.main-pagination-item.disabled .page-link {
    transform: none;
}

/* Estilo para pílula ATIVA (caso você use no futuro) */
.main-pagination-item.active .page-link {
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
}

/* Estilo DESABILITADO para todos os tipos de paginação */
.pagination .page-item.disabled .page-link {
    background-color: #f8f9fa;
    color: #adb5bd;
    border-color: #e9ecef;
    box-shadow: none;
    cursor: not-allowed;
}

/*
=============================================================================
9. AJUSTES RESPONSIVOS PARA PAGINAÇÃO
=============================================================================
*/
@media (max-width: 768px) {
    /*
     * O seletor :has() garante que o empilhamento vertical só aconteça
     * no container de paginação que CONTÉM os botões de texto.
     * A paginação numérica não será afetada.
    */
    .pagination:has(.main-pagination-item) {
        flex-direction: column;   /* Empilha os botões de texto */
        align-items: center;      /* Centraliza na vertical */
        gap: 12px;                /* Aumenta o espaço quando empilhado */
    }

    /* Expande os botões de texto para serem mais fáceis de tocar no celular */
    .pagination:has(.main-pagination-item) .main-pagination-item {
      width: 90%;
      max-width: 320px;
    }

    .pagination:has(.main-pagination-item) .main-pagination-item .page-link {
      display: block;
      text-align: center;
      width: 100%;
    }

    /*
     * Para a paginação numérica, em telas menores, apenas diminuímos um pouco
     * o tamanho dos botões para caberem melhor, sem empilhar.
    */
    .pagination .page-item:not(.main-pagination-item) .page-link {
        width: 38px;
        height: 38px;
        font-size: 0.9rem;
    }
}

 /* 
    =================================================================
    ESTILOS DA SEÇÃO DE FILTROS (COPIADO DA ÁREA DO PROFESSOR)
    =================================================================
    */
    .filter-card {
        background-color: #fff;
        border-radius: 16px;
        box-shadow: var(--card-shadow, 0 8px 25px rgba(0,0,0,0.07));
        border: none;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .filter-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background-color: var(--primary-very-light, #f8f5fc);
        border-bottom: 1px solid var(--gray-200, #e9ecef);
    }
    .filter-card-header h5 {
        color: var(--primary-dark, #4a2b70);
        font-weight: 600;
    }
    .btn-reset {
        background: none;
        border: none;
        color: var(--gray-600, #6c757d);
        font-weight: 500;
        font-size: 0.9rem;
        padding: 0.25rem 0.5rem;
        transition: all 0.3s ease;
        border-radius: 50px;
    }
    .btn-reset:hover {
        color: var(--primary, #6A3EA1);
        background-color: rgba(106, 62, 161, 0.1);
    }
    .filter-card-body {
        padding: 1.5rem;
    }
    .form-label {
        font-weight: 500;
        color: var(--gray-700, #495057);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    .form-control,
    .form-select {
        border-radius: 50px !important;
        border: 1px solid var(--gray-300, #ced4da);
        background-color: var(--body-bg, #f8f9fa);
        padding: 0.6rem 1.2rem;
        height: 48px;
        transition: all 0.3s ease;
        font-size: 0.95rem;
    }
    .form-control:focus,
    .form-select:focus {
        background-color: #fff;
        border-color: var(--primary, #6A3EA1);
        box-shadow: 0 0 0 3px rgba(106, 62, 161, 0.15);
    }
    .input-group .form-control {
        border-radius: 0 50px 50px 0 !important;
    }
    .input-group .input-group-text {
        background: transparent;
        border: 1px solid var(--gray-300, #ced4da);
        border-right: 0;
        border-radius: 50px 0 0 50px;
        color: var(--primary, #6A3EA1);
    }

    /*
=============================================================================
10. FILTROS DE CATEGORIA (CARROSSEL HORIZONTAL COM MÁSCARA)
=============================================================================
*/
.category-filters-container {
    width: 100%;
    overflow-x: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
    -webkit-mask-image: linear-gradient(to right, transparent, black 30px, black calc(100% - 30px), transparent);
    mask-image: linear-gradient(to right, transparent, black 30px, black calc(100% - 30px), transparent);
}
.category-filters-container::-webkit-scrollbar { display: none; }
.category-filters {
    display: flex;
    flex-wrap: nowrap;
    gap: 12px;
    padding: 0.5rem 30px;
    -webkit-overflow-scrolling: touch;
}
.btn-category-filter {
    display: inline-flex;
    align-items: center;
    padding: 0.7rem 1.5rem;
    background-color: var(--primary-very-light);
    color: var(--primary-dark);
    border: 1px solid rgba(106, 62, 161, 0.1);
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    white-space: nowrap;
    flex-shrink: 0;
}
.btn-category-filter:hover, .btn-category-filter:focus {
    background: var(--primary);
    color: white;
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 6px 15px rgba(106, 62, 161, 0.2);
    text-decoration: none;
    border-color: var(--primary);
}

/*
=============================================================================
11. CONTROLES DO CARROSSEL DE CATEGORIAS (SETAS)
=============================================================================
*/
.category-carousel-wrapper {
    position: relative;
    max-width: 900px;
    margin: 0 auto 2rem auto; /* Adicionado margem inferior */
}
.carousel-arrow {
    display: none;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: white;
    border: 1px solid var(--gray-300);
    color: var(--primary);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    z-index: 10;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}
.carousel-arrow:hover {
    background-color: var(--primary);
    color: white;
    transform: translateY(-50%) scale(1.1);
}
.carousel-arrow.prev { left: -20px; }
.carousel-arrow.next { right: -20px; }
.carousel-arrow.hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateY(-50%) scale(0.8);
}
@media (min-width: 992px) {
    .carousel-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
    }
}

/* 
===============================================================================
12. MODAL DE SUGESTÃO DE CONTATO (VERSÃO FINAL)
===============================================================================
*/
#sugerirContatoModal .modal-content {
    border: none;
    border-radius: 24px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    overflow: hidden;
}

#sugerirContatoModal .modal-header {
    background-color: var(--primary-very-light, #f8f5fc);
    border-bottom: 1px solid rgba(106, 62, 161, 0.1);
    padding: 1rem 1.5rem;
}

#sugerirContatoModal .modal-title {
    color: var(--primary-dark, #552A8A);
    font-weight: 600;
    font-size: 1.2rem;
}

#sugerirContatoModal .modal-body {
    padding: 1.5rem 2rem 2rem 2rem;
}

.form-description {
    font-size: 0.95rem;
    color: var(--gray-600, #6c757d);
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 16px;
    margin-bottom: 1.5rem;
    text-align: center;
}

#sugerirContatoModal .form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

#sugerirContatoModal .form-control,
#sugerirContatoModal .form-select {
    border-radius: 12px;
    border: 1px solid #ced4da;
    padding: 0.75rem 1rem;
    transition: all 0.2s ease-in-out;
}

#sugerirContatoModal .form-control:focus,
#sugerirContatoModal .form-select:focus {
    border-color: var(--primary, #6A3EA1);
    box-shadow: 0 0 0 3px rgba(106, 62, 161, 0.2);
}

.form-section-divider {
    width: 100%;
    text-align: center;
    border-bottom: 1px solid #e9ecef;
    line-height: 0.1em;
    margin: 2rem 0;
}

.form-section-divider span {
    background: #fff;
    padding: 0 15px;
    font-weight: 500;
    color: var(--gray-600, #6c757d);
    font-size: 0.85rem;
    text-transform: uppercase;
}

.custom-checkbox .form-check-input {
    display: none;
}

.custom-checkbox .form-check-label {
    display: inline-flex;
    align-items: center;
    padding: 0.6rem 1.2rem;
    border: 2px solid #e0e0e0;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.custom-checkbox .form-check-label i {
    margin-right: 0.6rem;
    color: var(--gray-600, #6c757d);
    transition: all 0.3s ease;
}

.custom-checkbox .form-check-input:checked + .form-check-label {
    background-color: var(--primary-very-light, #f8f5fc);
    border-color: var(--primary, #6A3EA1);
    color: var(--primary-dark, #552A8A);
}

.custom-checkbox .form-check-input:checked + .form-check-label i {
    color: var(--primary, #6A3EA1);
}

/* --- AJUSTE NO FOOTER --- */
#sugerirContatoModal .modal-footer {
    background-color: #f8f9fa;
    border-top: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: center; /* <<< MUDANÇA: Centraliza os botões */
    gap: 0.75rem; /* Adiciona espaço entre os botões */
}

#sugerirContatoModal .modal-footer .btn {
    border-radius: 50px;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
    font-weight: 600;
}

#sugerirContatoModal .modal-footer .btn-primary {
    background: var(--gradient-modern, linear-gradient(45deg, #6A3EA1, #8E44AD));
    border: none;
}

#sugerirContatoModal .modal-footer .btn-outline-secondary {
    border-width: 2px;
}


/* 
===============================================================================
13. AJUSTES RESPONSIVOS PARA O MODAL (MOBILE)
===============================================================================
*/
@media (max-width: 576px) {
    #sugerirContatoModal .modal-body {
        padding: 1.5rem; /* Reduz o padding lateral */
    }

    /* Melhora a legibilidade do placeholder no mobile */
    #sugerirContatoModal textarea::placeholder {
        font-size: 0.9rem; /* Torna o texto do placeholder ligeiramente menor */
    }

    /* Empilha os botões na vertical para facilitar o toque */
    #sugerirContatoModal .modal-footer {
        flex-direction: column-reverse; /* Coloca o botão primário no topo */
        gap: 0.5rem;
    }
    
    #sugerirContatoModal .modal-footer .btn {
        width: 100%; /* Faz os botões ocuparem a largura total */
    }
}
</style>
{% endblock %}