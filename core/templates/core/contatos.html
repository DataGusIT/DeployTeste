{% extends 'base.html' %}
{% load static %}
{% load query_tags %}

{% block content %}

<!-- ================================== -->
<!-- SEÇÃO HERO - Banner Principal     -->
<!-- ================================== -->
<section class="hero-section py-5">
    <div class="hero-overlay"></div>
    <div class="container py-4">
        <div class="row align-items-center">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="fw-bold display-5 mb-3 animate__animated animate__fadeInUp">
                    Rede de Apoio Especializada em Autismo
                </h1>
                <p class="lead mb-4 animate__animated animate__fadeInUp animate__delay-1s">
                    Conecte-se com profissionais, instituições e grupos de apoio dedicados ao atendimento e suporte para
                    pessoas com TEA e suas famílias.
                </p>
                <div class="d-flex justify-content-center gap-3 animate__animated animate__fadeInUp animate__delay-2s">
                    <a href="#contatos-section" class="btn btn-light btn-lg px-4">
                        <i class="fas fa-address-book me-2"></i>Ver contatos
                    </a>
                    <a href="#filtro-section" class="btn btn-outline-light btn-lg px-4">
                        <i class="fas fa-filter me-2"></i>Filtrar
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ================================== -->
<!-- SEÇÃO FILTROS - Sistema de busca  -->
<!-- ================================== -->
<section id="filtro-section" class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4 text-primary">
                            <i class="fas fa-filter me-2"></i>Encontre o apoio que você precisa
                        </h4>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Tipo de contato</label>
                                <select class="form-select" id="filtroTipo">
                                    <option value="todos">Todos os tipos</option>
                                    <option value="clinica">Clínicas</option>
                                    <option value="profissional">Profissionais</option>
                                    <option value="associacao">Associações</option>
                                    <option value="escola">Escolas</option>
                                    <option value="apoio">Grupos de Apoio</option>
                                    <option value="emergencia">Emergência</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Atendimento</label>
                                <select class="form-select" id="filtroAtendimento">
                                    <option value="todos">Todos os tipos</option>
                                    <option value="presencial">Presencial</option>
                                    <option value="online">Online</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Localização</label>
                                <select class="form-select" id="filtroLocalizacao">
                                    <option value="todos">Todas as localidades</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="outros">Outros estados</option>
                                </select>
                            </div>
                            <div class="col-12 text-end">
                                <button type="button" class="btn btn-primary px-4" id="btnFiltrar">
                                    <i class="fas fa-search me-2"></i>Filtrar resultados
                                </button>
                                <button type="button" class="btn btn-outline-secondary px-4" id="btnLimpar">
                                    <i class="fas fa-times me-2"></i>Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- ================================== -->
<!-- SEÇÃO CONTATOS - Lista principal  -->
<!-- ================================== -->
<section id="contatos-section" class="py-5">
    <div class="container">
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto text-center">
                <div class="section-subtitle">Nossa rede de apoio</div>
                <h2 class="section-title">Contatos Especializados</h2>
                <div class="section-divider"></div>
                <p class="section-description">
                    Uma rede completa de profissionais, instituições e serviços especializados no atendimento
                    de pessoas com Transtorno do Espectro Autista e suporte às suas famílias.
                </p>
            </div>
        </div>

        {# Verificação se há algum conteúdo para mostrar #}
        {% if contatos_por_categoria_paginada %}
            
            {# Loop principal pelas categorias da página #}
            {% for categoria, dados in contatos_por_categoria_paginada.items %}
                {% with contatos_page_obj=dados.contatos_page_obj query_param_name=dados.query_param_name %}

                    {# Só exibe a categoria se ela tiver contatos nesta página #}
                    {% if contatos_page_obj %}
                        <div class="contato-category mb-5" id="{{ categoria.nome|lower|slugify }}">
                            <div class="category-header">
                                <div class="category-icon">
                                    <i class="{{ categoria.icone }} text-primary fs-3"></i>
                                </div>
                                <h3 class="mb-0">{{ categoria.nome }}</h3>
                            </div>

                            <div class="row g-4">
                                {# Loop pelos contatos DA PÁGINA DE CONTATOS ATUAL #}
                                {% for contato in contatos_page_obj %}
                                    <div class="col-md-6 col-lg-4 contato-item">
                                        <div class="card h-100 border-0 shadow-sm hover-card">
                                            
                                            <div class="card-img-top position-relative">
                                                {# Verificamos o novo campo 'imagem_url' #}
                                                {% if contato.imagem_url %}
                                                    {# Usamos diretamente o 'imagem_url', sem o .url no final #}
                                                    <img src="{{ contato.imagem_url }}" alt="{{ contato.nome }}" class="img-fluid rounded-top" style="height: 200px; width: 100%; object-fit: cover;">
                                                {% else %}
                                                    {# O 'else' para a imagem padrão continua perfeito #}
                                                    <img src="{% static 'img/default-contact.jpg' %}" alt="{{ contato.nome }}" class="img-fluid rounded-top" style="height: 200px; width: 100%; object-fit: cover;">
                                                {% endif %}
                                                
                                                {% if user.is_authenticated %}
                                                    {% if contato.id in contatos_salvos_ids %}
                                                        <button type="button" class="btn btn-save-contact saved" data-contato-id="{{ contato.id }}" onclick="removerContato({{ contato.id }})" title="Remover dos salvos"><i class="fas fa-bookmark"></i></button>
                                                    {% else %}
                                                        <button type="button" class="btn btn-save-contact" data-contato-id="{{ contato.id }}" onclick="salvarContato({{ contato.id }})" title="Salvar contato"><i class="far fa-bookmark"></i></button>
                                                    {% endif %}
                                                {% else %}
                                                    <button type="button" class="btn btn-save-contact" onclick="showLoginRequired()" title="Faça login para salvar"><i class="far fa-bookmark"></i></button>
                                                {% endif %}

                                                <div class="position-absolute bottom-0 start-0 p-3">
                                                    <span class="badge bg-primary">{{ contato.categoria.nome }}</span>
                                                </div>
                                            </div>
                                            
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-3"><h5 class="card-title mb-0">{{ contato.nome }}</h5></div>
                                                <p class="card-text text-muted mb-3">{{ contato.descricao|truncatechars:80 }}</p>
                                                <div class="contact-info-item mb-2">
                                                    <div class="contact-info-icon"><i class="fas fa-map-marker-alt text-primary"></i></div>
                                                    <small>
                                                        {% if contato.rua %}{{ contato.rua }}{% if contato.numero %}, {{ contato.numero }}{% endif %}{% if contato.bairro %} - {{ contato.bairro }}{% endif %}<br>{% endif %}
                                                        {{ contato.cidade }}, {{ contato.estado }}{% if contato.cep %}<br>CEP: {{ contato.cep }}{% endif %}
                                                    </small>
                                                </div>
                                                <div class="contact-info-item mb-2">
                                                    <div class="contact-info-icon"><i class="fas fa-phone text-primary"></i></div>
                                                    <small>{{ contato.telefone }}</small>
                                                </div>
                                                <div class="contact-info-item mb-3">
                                                    <div class="contact-info-icon"><i class="fas fa-clock text-primary"></i></div>
                                                    <small>{{ contato.horario_funcionamento }}</small>
                                                </div>
                                                <div class="card-action-area">
                                                    <div class="mb-3">
                                                        {% if contato.atendimento_presencial %}<span class="badge bg-success me-1"><i class="fas fa-building me-1"></i>Presencial</span>{% endif %}
                                                        {% if contato.atendimento_online %}<span class="badge bg-info"><i class="fas fa-laptop me-1"></i>Online</span>{% endif %}
                                                    </div>
                                                    <div class="d-flex gap-2 flex-wrap"><a href="{% url 'detalhes_contato' contato.id %}" class="btn btn-sm btn-outline-primary flex-fill"><i class="fas fa-eye me-1"></i>Ver detalhes</a></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <!-- ============================================= -->
                            <!--      PAGINAÇÃO DOS CONTATOS (ANINHADA)      -->
                            <!-- ============================================= -->
                            <!-- PAGINAÇÃO DOS CONTATOS (ANINHADA) - VERSÃO CORRIGIDA -->
                            {% if contatos_page_obj.paginator.num_pages > 1 %}
                            <nav aria-label="Navegação de contatos para {{ categoria.nome }}" class="mt-4">
                                <ul class="pagination pagination-sm justify-content-center">
                                    {% if contatos_page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?{% build_query query_param_name contatos_page_obj.previous_page_number %}">&laquo;</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&laquo;</a></li>
                                    {% endif %}

                                    {% for i in contatos_page_obj.paginator.page_range %}
                                        {% if contatos_page_obj.number == i %}
                                            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                                        {% else %}
                                            <li class="page-item"><a class="page-link" href="?{% build_query query_param_name i %}">{{ i }}</a></li>
                                        {% endif %}
                                    {% endfor %}

                                    {% if contatos_page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?{% build_query query_param_name contatos_page_obj.next_page_number %}">&raquo;</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&raquo;</a></li>
                                    {% endif %}
                                </ul>
                            </nav>
                            {% endif %}
                            <!-- ============================================= -->
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}

            <!-- =============================================================================
            PAGINAÇÃO PRINCIPAL DAS CATEGORIAS (COM CLASSES ATUALIZADAS)
            ============================================================================= -->
            {% if page_obj.has_other_pages %}
            <nav aria-label="Navegação das páginas de categorias" class="mt-5">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        {# Adicionamos a classe 'main-pagination-item' aqui #}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.previous_page_number %}">&laquo; Categorias Anteriores</a>
                        </li>
                    {% endif %}
                    
                    {# E aqui também #}
                    <li class="page-item main-pagination-item disabled">
                        <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
                    </li>
                    
                    {% if page_obj.has_next %}
                        {# E finalmente aqui #}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.next_page_number %}">Próximas Categorias &raquo;</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

        {% else %}
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="alert alert-info p-4 shadow-sm rounded-3">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>Nenhum contato encontrado</h4>
                        <p class="mb-0">
                            Não há contatos cadastrados no momento. Entre em contato com o administrador para mais informações.
                        </p>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row mt-5">
            <div class="col-lg-8 mx-auto">
                <div class="card cta-card border-0 shadow">
                    <div class="card-body p-5 text-center text-white">
                        <h4 class="mb-3">Conhece algum profissional ou instituição especializada?</h4>
                        <p class="mb-4">Ajude a ampliar nossa rede de apoio indicando contatos que possam auxiliar famílias e pessoas com TEA.</p>
                        <button type="button" class="btn cta-btn" data-bs-toggle="modal" data-bs-target="#sugerirContatoModal"><i class="fas fa-plus-circle me-2"></i>Sugerir contato</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- MODAL DE LOGIN -->
<div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content login-modal-content">
            <div class="modal-header border-0 pb-0">
                <button type="button" class="btn-close-modern" data-bs-dismiss="modal" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body px-4 pb-4">
                <div class="text-center">
                    <div class="login-icon-wrapper mb-4">
                        <div class="login-icon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                    </div>
                    <h3 class="login-title mb-3" id="loginModalLabel">
                        Acesse sua conta
                    </h3>
                    <p class="login-description mb-4">
                        Para salvar suas dúvidas favoritas e personalizar sua experiência, 
                        faça login ou crie uma conta gratuita.
                    </p>
                    <div class="benefits-list mb-4">
                        <div class="benefit-item">
                            <i class="fas fa-bookmark"></i>
                            <span>Salve dúvidas favoritas</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-history"></i>
                            <span>Histórico personalizado</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-sync"></i>
                            <span>Sincronize dispositivos</span>
                        </div>
                    </div>
                    <div class="login-actions d-grid gap-3 mb-3">
                        <a href="{% url 'login' %}" class="btn btn-primary btn-lg btn-login">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            Entrar
                        </a>
                        <a href="{% url 'register' %}" class="btn btn-outline-primary btn-lg btn-register">
                            <i class="fas fa-user-plus me-2"></i>
                            Criar conta grátis
                        </a>
                    </div>
                    <div class="login-footer">
                        <button type="button" class="btn-link-modern" data-bs-dismiss="modal">
                            <i class="fas fa-arrow-left me-1"></i>
                            Continuar sem salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- =============================================================================
   CONTAINER DE NOTIFICAÇÕES (TOAST MODERNO)
   ============================================================================= -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div id="notificationToast" class="toast modern-toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body p-0">
            <div class="d-flex">
                <!-- Barra lateral colorida com ícone -->
                <div class="toast-icon-area d-flex align-items-center justify-content-center">
                    <i id="toastIcon" class="fas fa-check-circle"></i>
                </div>

                <!-- Conteúdo da mensagem -->
                <div class="toast-content-area p-3">
                    <h6 id="toastTitle" class="toast-title mb-1">Sucesso!</h6>
                    <p id="toastBody" class="toast-message mb-0">
                        O contato foi salvo com sucesso.
                    </p>
                </div>
                
                <!-- Botão de fechar -->
                <button type="button" class="btn-close-toast" data-bs-dismiss="toast" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        $("#btnFiltrar").click(function () {
            const tipoFiltro = $("#filtroTipo").val();
            const atendimentoFiltro = $("#filtroAtendimento").val();
            const localizacaoFiltro = $("#filtroLocalizacao").val();
            let url = "{% url 'contatos' %}?";
            if (tipoFiltro && tipoFiltro !== "todos") url += `tipo=${tipoFiltro}&`;
            if (atendimentoFiltro && atendimentoFiltro !== "todos") url += `atendimento=${atendimentoFiltro}&`;
            if (localizacaoFiltro && localizacaoFiltro !== "todos") url += `localizacao=${localizacaoFiltro}&`;
            window.location.href = url;
        });

        $("#btnLimpar").click(function () {
            window.location.href = "{% url 'contatos' %}";
        });

        $("#btnEnviarSugestao").click(function () {
            if ($("#formSugerirContato")[0].checkValidity()) {
                $("#formSugerirContato").submit();
                $("#sugerirContatoModal").modal('hide');
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Sugestão enviada!',
                        text: 'Agradecemos sua contribuição para nossa rede de apoio.',
                        confirmButtonColor: '#3085d6'
                    });
                } else {
                    alert('Sugestão enviada! Agradecemos sua contribuição para nossa rede de apoio.');
                }
                $("#formSugerirContato")[0].reset();
            } else {
                $("#formSugerirContato")[0].reportValidity();
            }
        });

        $(".hover-card").hover(
            function () {
                $(this).addClass("shadow").css({ "transform": "translateY(-5px)", "transition": "all 0.3s ease" });
            },
            function () {
                $(this).removeClass("shadow").css("transform", "translateY(0)");
            }
        );
    });

    function salvarContato(contatoId) {
        fetch(`/salvar-contato/${contatoId}/`, {
            method: 'POST',
            headers: { 'X-CSRFToken': getCookie('csrftoken'), 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateButton(contatoId, true);
                // ATUALIZADO: Chamando showToast com título e mensagem
                showToast('Contato Salvo!', 'Este contato foi adicionado à sua lista de favoritos.', 'success');
            } else {
                showToast('Ops!', data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            showToast('Erro de Rede', 'Não foi possível salvar o contato. Tente novamente.', 'error');
        });
    }

    function removerContato(contatoId) {
        fetch(`/remover-contato/${contatoId}/`, {
            method: 'POST',
            headers: { 'X-CSRFToken': getCookie('csrftoken'), 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateButton(contatoId, false);
                // ATUALIZADO: Mensagem de remoção também aprimorada
                showToast('Contato Removido', 'O contato foi removido da sua lista de salvos.', 'info');
            } else {
                showToast('Ops!', data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            showToast('Erro de Rede', 'Não foi possível remover o contato. Tente novamente.', 'error');
        });
    }

    function updateButton(contatoId, isSaved) {
        const button = document.querySelector(`button[data-contato-id="${contatoId}"]`);
        if (button) {
            const icon = button.querySelector('i');
            if (isSaved) {
                button.classList.add('saved');
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.onclick = () => removerContato(contatoId);
                button.title = 'Remover dos salvos';
            } else {
                button.classList.remove('saved');
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.onclick = () => salvarContato(contatoId);
                button.title = 'Salvar contato';
            }
        }
    }

    function showLoginRequired() {
        const modalElement = document.getElementById('loginModal');
        if (modalElement) {
            const loginModal = new bootstrap.Modal(modalElement);
            loginModal.show();
        } else {
            console.error("O elemento do modal de login (#loginModal) não foi encontrado no DOM.");
            alert("Para salvar, você precisa fazer login. Redirecionando para a página de login.");
            window.location.href = '/login/';
        }
    }

    /**
     * ATUALIZADO: Exibe uma notificação toast moderna e customizada.
     * @param {string} title - O título da notificação.
     * @param {string} message - A mensagem principal.
     * @param {string} type - O tipo de notificação ('success', 'error', 'info', 'warning').
     */
    function showToast(title, message, type = 'info') {
        const toastElement = document.getElementById('notificationToast');
        if (!toastElement) {
            console.error("Elemento de Toast não encontrado!");
            return;
        }
        const toast = new bootstrap.Toast(toastElement, { delay: 5000 }); // Aumenta o tempo para 5s

        const toastIconArea = toastElement.querySelector('.toast-icon-area');
        const toastIcon = toastElement.querySelector('#toastIcon');
        const toastTitle = toastElement.querySelector('#toastTitle');
        const toastBody = toastElement.querySelector('#toastBody');

        // Configurações baseadas no tipo para um visual mais rico
        const configs = {
            success: {
                icon: 'fa-check-circle',
                colorClass: 'toast-success',
                defaultTitle: 'Sucesso!'
            },
            error: {
                icon: 'fa-times-circle',
                colorClass: 'toast-error',
                defaultTitle: 'Erro!'
            },
            info: {
                icon: 'fa-info-circle',
                colorClass: 'toast-info',
                defaultTitle: 'Informação'
            },
            warning: {
                icon: 'fa-exclamation-triangle',
                colorClass: 'toast-warning',
                defaultTitle: 'Atenção!'
            }
        };

        const config = configs[type] || configs.info;

        // Atualiza o conteúdo do toast
        toastTitle.textContent = title || config.defaultTitle;
        toastBody.textContent = message;
        
        // Atualiza ícone e classes de cor
        toastIcon.className = `fas ${config.icon}`;
        toastIconArea.className = 'toast-icon-area d-flex align-items-center justify-content-center'; // Reseta classes
        toastIconArea.classList.add(config.colorClass);

        // Adiciona uma classe de animação ao mostrar
        toastElement.classList.remove('hide');
        toastElement.classList.add('show', 'animate__animated', 'animate__fadeInRight');
        
        toast.show();

        // Remove a animação ao esconder para evitar piscadas
        toastElement.addEventListener('hidden.bs.toast', function () {
            toastElement.classList.remove('animate__animated', 'animate__fadeInRight');
        });
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>
<style>
    /*
===============================================================================
ESTRUTURA GERAL DO CSS
===============================================================================
1. Variáveis CSS
2. Componentes Base
3. Cards de Contato
4. Botões
5. Notificações Toast
6. Navegação e Cabeçalhos
7. Modal de Login
8. Animações
9. Responsividade
===============================================================================
*/

/* 
===============================================================================
1. VARIÁVEIS CSS
===============================================================================
*/
:root {
    --primary: #6A3EA1;
    --primary-light: #8E44AD;
    --gradient-modern: linear-gradient(45deg, #6A3EA1, #8E44AD);
    --shadow-modern: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
    --border-radius-lg: 20px;
    --border-radius-md: 15px;
    --border-radius-sm: 12px;
    --border-radius-full: 50px;
    --transition-smooth: all 0.3s ease;
    --transition-bounce: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* 
===============================================================================
2. CARDS DE CONTATO
===============================================================================
*/
.hover-card {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    transition: var(--transition-bounce);
    position: relative;
    z-index: 1;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
}

.hover-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(106, 62, 161, 0.15);
}

.hover-card:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
    z-index: 2;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease;
}

.hover-card:hover:before {
    transform: scaleX(1);
}

.hover-card .card-img-top {
    transition: all 0.5s ease;
}

.hover-card:hover .card-img-top {
    transform: scale(1.05);
}

.hover-card .card-body {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 1.5rem;
}

.card-action-area {
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Informações de Contato */
.contact-info-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.8rem;
    position: relative;
    padding-left: 2rem;
}

.contact-info-icon {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    color: var(--primary);
    transition: var(--transition-smooth);
}

.hover-card:hover .contact-info-icon {
    transform: translateY(-50%) scale(1.2);
}

/* 
===============================================================================
3. SISTEMA DE BOTÕES
===============================================================================
*/

/* Botão Salvar Contato */
.btn-save-contact {
    position: absolute;
    top: 15px;
    right: 15px;
    background: transparent;
    border: none;
    padding: 5px;
    cursor: pointer;
    z-index: 5;
    transition: transform 0.3s ease;
}

.btn-save-contact > i {
    font-size: 1.6rem;
    color: white;
    text-shadow: 0 1px 5px rgba(0, 0, 0, 0.6);
    transition: var(--transition-smooth);
}

.btn-save-contact:hover {
    transform: scale(1.2);
}

.btn-save-contact.saved > i {
    color: var(--primary);
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Botão Detalhes Moderno */
.btn-details-modern {
    display: inline-block;
    padding: 0.6rem 1.5rem;
    border-radius: var(--border-radius-full);
    font-weight: 600;
    font-size: 0.8rem;
    color: white;
    text-align: center;
    text-decoration: none;
    border: none;
    background: var(--gradient-modern);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.25);
    transition: var(--transition-smooth);
}

.btn-details-modern:hover {
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(106, 62, 161, 0.4);
}

/* Botões CTA */
.cta-btn {
    background-color: white;
    color: var(--primary);
    font-weight: 600;
    padding: 0.8rem 2rem;
    border-radius: var(--border-radius-full);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transition: var(--transition-smooth);
}

.cta-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

/* 
===============================================================================
4. NOTIFICAÇÕES TOAST (VERSÃO APRIMORADA)
===============================================================================
*/
/* Container principal para posicionamento */
.toast-container {
    z-index: 9999 !important; /* Garante que o toast fique acima de tudo */
}

/* Corpo do Toast Moderno */
.modern-toast {
    width: 380px;
    max-width: 95%;
    background-color: #fff;
    border-radius: var(--border-radius-md); /* Borda mais suave */
    border: none;
    box-shadow: 0 15px 40px -10px rgba(0, 0, 0, 0.2); /* Sombra mais pronunciada */
    overflow: hidden;
    /* Adiciona uma borda sutil na parte inferior */
    border-bottom: 4px solid transparent; 
    transition: all 0.4s ease-in-out;
}

/* Variações de Cor (aplicadas na borda inferior) */
.modern-toast .toast-success { border-bottom-color: #28a745; }
.modern-toast .toast-error { border-bottom-color: #dc3545; }
.modern-toast .toast-info { border-bottom-color: #0dcaf0; }
.modern-toast .toast-warning { border-bottom-color: #ffc107; }

/* Animação de entrada */
.modern-toast.show {
    animation: fadeInRight 0.5s ease forwards;
}

.toast-body {
    padding: 0 !important; /* Removemos o padding padrão */
}

/* Área do Ícone Colorida */
.toast-icon-area {
    flex: 0 0 60px; /* Um pouco maior para mais destaque */
    color: #fff;
    font-size: 1.8rem; /* Ícone maior */
    transition: background-color 0.3s ease;
    border-top-left-radius: var(--border-radius-md);
}

/* Variações de Cor da Área do Ícone */
.toast-icon-area.toast-success { background: linear-gradient(135deg, #28a745, #218838); }
.toast-icon-area.toast-error { background: linear-gradient(135deg, #dc3545, #c82333); }
.toast-icon-area.toast-info { background: linear-gradient(135deg, #17a2b8, #138496); }
.toast-icon-area.toast-warning { background: linear-gradient(135deg, #ffc107, #e0a800); }


/* Área de Conteúdo do Toast */
.toast-content-area {
    flex-grow: 1;
    padding: 1rem 1.2rem; /* Espaçamento interno generoso */
}

.toast-title {
    font-weight: 700;
    font-size: 1.1rem; /* Título mais proeminente */
    color: #343a40;
    margin-bottom: 0.25rem;
}

.toast-message {
    font-size: 0.95rem;
    color: #6c757d;
    line-height: 1.5;
}

/* Botão de Fechar Moderno */
.btn-close-toast {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: #adb5bd;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-smooth);
}

.btn-close-toast:hover {
    background-color: #f1f3f5;
    color: #495057;
    transform: rotate(90deg) scale(1.1);
}

/* 
===============================================================================
5. NAVEGAÇÃO E CABEÇALHOS
===============================================================================
*/

/* Navegação de Contatos */
.contact-nav {
    margin-bottom: 2rem;
    padding: 0.8rem;
}

.contact-nav .btn {
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: all 0.4s ease;
    border-radius: var(--border-radius-lg);
}

.contact-nav .btn:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: all 0.6s ease;
    z-index: -1;
}

.contact-nav .btn:hover:before {
    left: 100%;
}

/* Cabeçalhos de Categoria */
.category-header {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius-md);
    margin-bottom: 1.5rem;
    transform: translateY(0);
    transition: var(--transition-smooth);
}

.category-header:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(106, 62, 161, 0.15);
}

.category-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.15);
    margin-right: 1.5rem;
}

/* Cards CTA */
.cta-card {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    background: var(--gradient-modern);
    position: relative;
    z-index: 1;
}

/* 
===============================================================================
6. MODAL DE LOGIN
===============================================================================
*/

/* Backdrop */
.modal-backdrop.show {
    backdrop-filter: blur(10px);
    background-color: rgba(0, 0, 0, 0.3);
}

/* Modal Principal */
.login-modal .modal-dialog {
    max-width: 440px;
    margin: 1rem auto;
}

.login-modal-content {
    border: 2px solid #ccc;
    border-radius: 24px;
    box-shadow: var(--shadow-modern);
    background: white;
    overflow: hidden;
}

.login-modal .modal-header {
    position: relative;
    padding: 1rem 1rem 0;
}

/* Botão de Fechar Modal */
.btn-close-modern {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    cursor: pointer;
    transition: var(--transition-smooth);
    z-index: 10;
}

.btn-close-modern:hover {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    transform: rotate(90deg);
}

/* Ícone de Login */
.login-icon-wrapper {
    position: relative;
}

.login-icon {
    width: 70px;
    height: 70px;
    background: var(--gradient-modern);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    animation: pulse-modern 2s infinite;
}

.login-icon i {
    font-size: 1.8rem;
    color: white;
}

/* Textos do Modal */
.login-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.login-description {
    font-size: 1rem;
    color: #6c757d;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

/* Lista de Benefícios */
.benefits-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-bottom: 2rem;
}

.benefit-item {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 1rem;
    background: rgba(106, 62, 161, 0.05);
    border-radius: 16px;
    transition: var(--transition-smooth);
}

.benefit-item:hover {
    background: rgba(106, 62, 161, 0.1);
    transform: translateX(5px);
}

.benefit-item i {
    color: var(--primary);
    margin-right: 12px;
    width: 16px;
    font-size: 0.9rem;
}

.benefit-item span {
    font-size: 0.9rem;
    color: #495057;
    font-weight: 500;
}

/* Rodapé do Modal */
.login-footer {
    border-top: 1px solid #e9ecef;
    padding-top: 1rem;
}

.btn-link-modern {
    background: none;
    border: none;
    color: #6c757d;
    font-size: 0.9rem;
    cursor: pointer;
    transition: var(--transition-smooth);
    padding: 0.5rem 1rem;
    border-radius: 30px;
}

.btn-link-modern:hover {
    color: var(--primary);
    background: rgba(106, 62, 161, 0.05);
}

/* 
===============================================================================
7. ANIMAÇÕES
===============================================================================
*/

/* Animação de Entrada */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Animação de Pulso */
@keyframes pulse-modern {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

/* Aplicação das Animações */
.contato-item {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
}

.contato-item:nth-child(2) { animation-delay: 0.1s; }
.contato-item:nth-child(3) { animation-delay: 0.2s; }
.contato-item:nth-child(4) { animation-delay: 0.3s; }
.contato-item:nth-child(5) { animation-delay: 0.4s; }
.contato-item:nth-child(6) { animation-delay: 0.5s; }

/* 
===============================================================================
8. RESPONSIVIDADE
===============================================================================
*/

/* Dispositivos Móveis */
@media (max-width: 576px) {
    .login-modal .modal-dialog {
        margin: 1rem;
        max-width: none;
    }
    
    .modal-body {
        padding: 1.5rem !important;
    }
    
    .login-icon {
        width: 60px;
        height: 60px;
    }
    
    .login-icon i {
        font-size: 1.5rem;
    }
    
    .login-title {
        font-size: 1.3rem;
    }
    
    .login-description {
        font-size: 0.9rem;
    }
    
    .benefit-item {
        padding: 0.4rem 0.8rem;
    }
    
    .benefit-item span {
        font-size: 0.85rem;
    }
    
    .btn-login,
    .btn-register {
        padding: 10px 20px;
        font-size: 0.9rem;
    }
}

/* Tablets */
@media (min-width: 577px) and (max-width: 768px) {
    .modern-toast {
        width: 340px;
    }
    
    .category-header {
        padding: 0.8rem 1.2rem;
    }
    
    .category-icon {
        width: 50px;
        height: 50px;
        margin-right: 1rem;
    }
}

@media (max-width: 768px) {
    
    /* Seleciona o container que envolve os botões de "Filtrar" e "Limpar" */
    #filtro-section .col-12.text-end {
        /* Converte o container em flexbox para controlar o alinhamento */
        display: flex;
        
        /* Empilha os botões verticalmente */
        flex-direction: column;
        
        /* Centraliza os botões na horizontal */
        align-items: center;
        
        /* Cria o espaçamento vertical entre os botões */
        gap: 12px;
        
        /* Adiciona um espaço acima do primeiro botão para separá-lo dos selects */
        margin-top: 1rem;
    }

    /* Faz os botões ocuparem uma largura agradável e consistente */
    #filtro-section #btnFiltrar,
    #filtro-section #btnLimpar {
        width: 100%;
        max-width: 350px; /* Define uma largura máxima para não ficarem esticados demais */
        margin: 0; /* Remove qualquer margem lateral que possa existir */
    }
}

/* Desktop Grande */
@media (min-width: 1200px) {
    .hover-card:hover {
        transform: translateY(-15px);
    }
    
    .category-header:hover {
        transform: translateY(-8px);
    }
}

/*
=============================================================================
8. CORREÇÃO DE PAGINAÇÃO (VERSÃO FINAL CORRIGIDA E RESPONSIVA)
=============================================================================
*/

/* --- A. ESTILOS GERAIS DO CONTAINER --- */
.pagination {
    display: flex;
    flex-wrap: wrap; /* Permite que os botões quebrem a linha em telas médias */
    justify-content: center;
    gap: 8px; /* Espaçamento entre todos os botões */
    list-style: none;
    padding-left: 0;
}

.pagination .page-item {
    margin: 0 !important; /* Remove margens padrão para usar 'gap' */
}

/* --- B. ESTILOS PARA PAGINAÇÃO NUMÉRICA (CÍRCULOS) --- */
/* A regra :not(.main-pagination-item) é a chave!
   Ela aplica estes estilos apenas aos botões que NÃO são da paginação de texto. */
.pagination .page-item:not(.main-pagination-item) .page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: 50%; /* Perfeitamente circular */
    font-weight: 600;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

/* Hover para botões numéricos */
.pagination .page-item:not(.main-pagination-item):not(.active):not(.disabled) .page-link:hover {
    transform: translateY(-3px);
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.15);
}

/* Estilo ATIVO para botões numéricos */
.pagination .page-item:not(.main-pagination-item).active .page-link {
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.3);
    transform: scale(1.05); /* Efeito de destaque */
}

/* --- C. ESTILOS PARA PAGINAÇÃO DE TEXTO (PÍLULAS) --- */
/* Estilo base que anula qualquer conflito com os estilos circulares */
.main-pagination-item .page-link {
    display: inline-block;
    width: auto;
    height: auto;
    border-radius: 50px; /* Formato de pílula */
    padding: 0.5rem 1.2rem;
    white-space: nowrap;
    font-weight: 500;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

/* Efeito de hover específico para as pílulas */
.page-item.main-pagination-item:not(.disabled) .page-link:hover {
    transform: translateY(-2px);
    border-color: var(--primary);
    background-color: var(--primary);
    color: #fff;
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.2);
}

/* Garante que o item ativo ou desabilitado da paginação de texto não tenha escala */
.main-pagination-item.active .page-link,
.main-pagination-item.disabled .page-link {
    transform: none;
}

/* Estilo para pílula ATIVA (caso você use no futuro) */
.main-pagination-item.active .page-link {
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
}

/* Estilo DESABILITADO para todos os tipos de paginação */
.pagination .page-item.disabled .page-link {
    background-color: #f8f9fa;
    color: #adb5bd;
    border-color: #e9ecef;
    box-shadow: none;
    cursor: not-allowed;
}

/*
=============================================================================
9. AJUSTES RESPONSIVOS PARA PAGINAÇÃO
=============================================================================
*/
@media (max-width: 768px) {
    /*
     * O seletor :has() garante que o empilhamento vertical só aconteça
     * no container de paginação que CONTÉM os botões de texto.
     * A paginação numérica não será afetada.
    */
    .pagination:has(.main-pagination-item) {
        flex-direction: column;   /* Empilha os botões de texto */
        align-items: center;      /* Centraliza na vertical */
        gap: 12px;                /* Aumenta o espaço quando empilhado */
    }

    /* Expande os botões de texto para serem mais fáceis de tocar no celular */
    .pagination:has(.main-pagination-item) .main-pagination-item {
      width: 90%;
      max-width: 320px;
    }

    .pagination:has(.main-pagination-item) .main-pagination-item .page-link {
      display: block;
      text-align: center;
      width: 100%;
    }

    /*
     * Para a paginação numérica, em telas menores, apenas diminuímos um pouco
     * o tamanho dos botões para caberem melhor, sem empilhar.
    */
    .pagination .page-item:not(.main-pagination-item) .page-link {
        width: 38px;
        height: 38px;
        font-size: 0.9rem;
    }
}
</style>
{% endblock %}