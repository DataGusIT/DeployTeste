{% extends 'base.html' %}
{% load static %}
{% load query_tags %}

{% block title %}Dúvidas Frequentes sobre Autismo{% endblock %}

{% block content %}

<!-- =============================================================================
   SEÇÃO HERO - CABEÇALHO DA PÁGINA
   ============================================================================= -->
<section class="hero-section" style="padding: 4rem 0;">
    <div class="hero-overlay"></div>
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-12 text-center">
                <h1 class="display-4 fw-bold mb-4 animate__animated animate__fadeInUp">
                    Dúvidas Frequentes
                </h1>
                <p class="lead mb-4 animate__animated animate__fadeInUp animate__delay-1s">
                    Aqui você encontra respostas para as perguntas mais comuns sobre o Transtorno do Espectro Autista
                </p>
            </div>
        </div>
    </div>
</section>

<!-- =============================================================================
   SEÇÃO PRINCIPAL - CONTEÚDO FAQ
   ============================================================================= #} -->
<section class="py-5">
    <div class="container">
        
        <!-- Formulário de pesquisa -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 text-center">
                <div class="section-subtitle">Encontre respostas</div>
                <h2 class="section-title">O que você precisa saber sobre o autismo</h2>
                <div class="section-divider"></div>
                <p class="section-description mb-5">Explore pesquisas respondendo dúvidas sobre o transtorno do espectro autista.</p>
                <div class="row justify-content-center mb-5">
                    <div class="col-md-8">
                        <form action="{% url 'pesquisar_faqs' %}" method="post" class="d-flex">
                            {% csrf_token %}
                            <div class="input-group">
                                <input type="text" name="termo" class="form-control" placeholder="O que você quer saber?" value="{{ termo_pesquisa }}" aria-label="Termo de pesquisa" autocomplete="off">
                                <button class="btn btn-primary" type="submit"><i class="fas fa-search me-2"></i> Pesquisar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        {% if faqs_por_categoria_paginada %}
            <!-- ACORDEÕES DE FAQ POR CATEGORIA -->
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    {% for categoria, dados in faqs_por_categoria_paginada.items %}
                        {% with faqs_page_obj=dados.faqs_page_obj query_param_name=dados.query_param_name %}
                            
                            {% if faqs_page_obj %}
                                <div class="mb-5" id="{{ categoria.nome|lower|slugify }}">
                                    <!-- Cabeçalho da categoria -->
                                    <div class="d-flex align-items-center mb-4">
                                        <div class="feature-icon me-3"><i class="{{ categoria.icone }}"></i></div>
                                        <h3 class="feature-title mb-0">{{ categoria.nome }}</h3>
                                    </div>

                                    <!-- Acordeão -->
                                    <div class="accordion shadow-sm" id="accordion-{{ categoria.id }}">
                                        {% for faq in faqs_page_obj %}
                                            <div class="accordion-item border-0 mb-3 rounded-3 overflow-hidden">
                                                <h2 class="accordion-header" id="heading-{{ faq.id }}">
                                                    <div class="d-flex align-items-center">
                                                        <button class="accordion-button collapsed fw-medium flex-grow-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ faq.id }}" aria-expanded="false" aria-controls="collapse-{{ faq.id }}">{{ faq.pergunta }}</button>
                                                        <div class="faq-save-button ms-3 me-3">
                                                            {% if user.is_authenticated %}
                                                                {% if faq.id in faqs_salvas_ids %}
                                                                    <button class="btn btn-primary btn-icon" onclick="removerFAQ({{ faq.id }}, this)"><i class="fas fa-bookmark"></i></button>
                                                                {% else %}
                                                                    <button class="btn btn-outline-primary btn-icon" onclick="salvarFAQ({{ faq.id }}, this)"><i class="far fa-bookmark"></i></button>
                                                                {% endif %}
                                                            {% else %}
                                                                <button class="btn btn-outline-primary btn-icon" onclick="mostrarLoginAlert()"><i class="far fa-bookmark"></i></button>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </h2>
                                                <div id="collapse-{{ faq.id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ faq.id }}" data-bs-parent="#accordion-{{ categoria.id }}">
                                                    <div class="accordion-body">
                                                        <div class="faq-content">{{ faq.resposta|linebreaksbr|safe }}</div>
                                                        
                                                        {% if faq.fonte %}
                                                            <div class="faq-source">
                                                                <a href="{{ faq.fonte }}" target="_blank" rel="noopener noreferrer" class="faq-source-link">
                                                                    <i class="fas fa-external-link-alt"></i>
                                                                    <span>Ver fonte completa</span>
                                                                </a>
                                                            </div>
                                                        {% endif %}

                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>

                                    <!-- PAGINAÇÃO DAS DÚVIDAS (ANINHADA) -->
                                    {% if faqs_page_obj.paginator.num_pages > 1 %}
                                    <nav aria-label="Navegação de dúvidas para {{ categoria.nome }}" class="mt-4">
                                        <ul class="pagination pagination-sm justify-content-center">
                                            {% if faqs_page_obj.has_previous %}
                                                <li class="page-item"><a class="page-link" href="?{% build_query query_param_name faqs_page_obj.previous_page_number %}">&laquo;</a></li>
                                            {% else %}
                                                <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&laquo;</a></li>
                                            {% endif %}
                                            {% for i in faqs_page_obj.paginator.page_range %}
                                                {% if faqs_page_obj.number == i %}
                                                    <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                                                {% else %}
                                                    <li class="page-item"><a class="page-link" href="?{% build_query query_param_name i %}">{{ i }}</a></li>
                                                {% endif %}
                                            {% endfor %}
                                            {% if faqs_page_obj.has_next %}
                                                <li class="page-item"><a class="page-link" href="?{% build_query query_param_name faqs_page_obj.next_page_number %}">&raquo;</a></li>
                                            {% else %}
                                                <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">&raquo;</a></li>
                                            {% endif %}
                                        </ul>
                                    </nav>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>
            </div>

            <!-- =============================================================================
            PAGINAÇÃO PRINCIPAL DAS CATEGORIAS (COM CLASSES ATUALIZADAS)
            ============================================================================= -->
            {% if page_obj.has_other_pages %}
            <nav aria-label="Navegação das páginas de categorias" class="mt-5">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        {# Adicionamos a classe 'main-pagination-item' aqui #}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.previous_page_number %}">&laquo; Categorias Anteriores</a>
                        </li>
                    {% endif %}
                    
                    {# E aqui também #}
                    <li class="page-item main-pagination-item disabled">
                        <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
                    </li>
                    
                    {% if page_obj.has_next %}
                        {# E finalmente aqui #}
                        <li class="page-item main-pagination-item">
                            <a class="page-link" href="?{% query_transform page=page_obj.next_page_number %}">Próximas Categorias &raquo;</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        
        {% else %}
            <!-- MENSAGEM QUANDO NÃO HÁ RESULTADOS -->
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="alert alert-info p-4 shadow-sm rounded-3">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>Nenhuma informação encontrada</h4>
                        <p class="mb-0">
                            {% if termo_pesquisa %}<span>Não encontramos resultados para "{{ termo_pesquisa }}". </span>{% endif %}
                            Tente usar termos diferentes ou entre em contato conosco para mais informações.
                        </p>
                    </div>
                </div>
            </div>
        {% endif %}
        
        <!-- CALL TO ACTION 
        <div class="row mt-5">
            <div class="col-lg-10 mx-auto">
                <div class="card border-0 shadow-sm" style="background: linear-gradient(45deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: 16px;">
                    <div class="card-body p-5 text-white">
                        <div class="row align-items-center">
                            <div class="col-lg-8"><h3 class="mb-3">Ainda tem dúvidas?</h3><p class="mb-lg-0">Se você não encontrou a resposta que procura, entre em contato com nossa equipe. Estamos aqui para ajudar.</p></div>
                            <div class="col-lg-4 text-lg-end mt-4 mt-lg-0"><a href="{% url 'contatos' %}" class="btn btn-light btn-lg"><i class="fas fa-envelope me-2"></i> Fale Conosco</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
    </div>
</section>
<!-- =============================================================================
   SEÇÃO DE RECURSOS ADICIONAIS
   ============================================================================= 
<section class="py-5 bg-light">
    <div class="container">
        
        {# Cabeçalho da seção #}
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 text-center">
                <div class="section-subtitle">Explore</div>
                <h2 class="section-title">O que você pode encontrar aqui</h2>
                <div class="section-divider"></div>
                <p class="section-description">
                    Um espaço simples para conhecer mais sobre o autismo e encontrar informações úteis
                </p>
            </div>
        </div>

        {# Cards de recursos #}
        <div class="row">
            
            {# Card 1 - Informações básicas #}
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm feature-card">
                    <div class="card-body p-4 text-center">
                        <div class="feature-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h4 class="feature-title">Informações básicas</h4>
                        <p class="feature-description">
                            Conteúdo introdutório sobre autismo, características e dicas simples do dia a dia
                        </p>
                        <a href="#" class="feature-link">
                            Saiba mais <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>

            {# Card 2 - Atividades práticas #}
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm feature-card">
                    <div class="card-body p-4 text-center">
                        <div class="feature-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <h4 class="feature-title">Atividades práticas</h4>
                        <p class="feature-description">
                            Ideias de jogos, brincadeiras e exercícios que podem ajudar no desenvolvimento
                        </p>
                        <a href="{% url 'ferramentas' %}" class="feature-link">
                            Ver atividades <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>

            {# Card 3 - Apoio e orientação #}
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm feature-card">
                    <div class="card-body p-4 text-center">
                        <div class="feature-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h4 class="feature-title">Apoio e orientação</h4>
                        <p class="feature-description">
                            Dicas para funcionários e informações sobre onde buscar ajuda profissional
                        </p>
                        <a href="#" class="feature-link">
                            Acessar <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section> -->

<!-- =============================================================================
   MODAL DE LOGIN MODERNO - VERSÃO REFATORADA
   ============================================================================= -->
<div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content login-modal-content">
            <!-- Header com botão de fechar -->
            <div class="modal-header border-0 pb-0">
                <button type="button" class="btn-close-modern" data-bs-dismiss="modal" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Corpo do modal -->
            <div class="modal-body px-4 pb-4">
                <div class="text-center">
                    <!-- Ícone animado -->
                    <div class="login-icon-wrapper mb-4">
                        <div class="login-icon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                    </div>
                    
                    <!-- Título e descrição -->
                    <h3 class="login-title mb-3" id="loginModalLabel">
                        Acesse sua conta
                    </h3>
                    <p class="login-description mb-4">
                        Para salvar suas dúvidas favoritas e personalizar sua experiência, 
                        faça login ou crie uma conta gratuita.
                    </p>
                    
                    <!-- Lista de benefícios -->
                    <div class="benefits-list mb-4">
                        <div class="benefit-item">
                            <i class="fas fa-bookmark"></i>
                            <span>Salve dúvidas favoritas</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-history"></i>
                            <span>Histórico personalizado</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-sync"></i>
                            <span>Sincronize dispositivos</span>
                        </div>
                    </div>
                    
                    <!-- Botões de ação -->
                    <div class="login-actions d-grid gap-3 mb-3">
                        <a href="{% url 'login' %}" class="btn btn-primary btn-lg btn-login">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            Entrar
                        </a>
                        <a href="{% url 'register' %}" class="btn btn-outline-primary btn-lg btn-register">
                            <i class="fas fa-user-plus me-2"></i>
                            Criar conta grátis
                        </a>
                    </div>
                    
                    <!-- Link alternativo -->
                    <div class="login-footer">
                        <button type="button" class="btn-link-modern" data-bs-dismiss="modal">
                            <i class="fas fa-arrow-left me-1"></i>
                            Continuar sem salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- =============================================================================
   CONTAINER DE NOTIFICAÇÕES (TOAST MODERNO)
   ============================================================================= -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div id="notificationToast" class="toast modern-toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body p-0">
            <div class="d-flex">
                <!-- Barra lateral colorida com ícone -->
                <div class="toast-icon-area d-flex align-items-center justify-content-center">
                    <i id="toastIcon" class="fas fa-check-circle"></i>
                </div>

                <!-- Conteúdo da mensagem -->
                <div class="toast-content-area p-3">
                    <h6 id="toastTitle" class="toast-title mb-1">Sucesso!</h6>
                    <p id="toastBody" class="toast-message mb-0">
                        Sua notificação aparecerá aqui.
                    </p>
                </div>
                
                <!-- Botão de fechar -->
                <button type="button" class="btn-close-toast" data-bs-dismiss="toast" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

<!-- =============================================================================
   JAVASCRIPT CUSTOMIZADO
   ============================================================================= -->

{% block extra_js %}
<script>
    // =============================================================================
    // FUNCIONALIDADES DE NAVEGAÇÃO E INTERFACE
    // =============================================================================
    
    /**
     * Implementa scroll suave para navegação entre categorias
     */
    function initSmoothScrolling() {
        document.querySelectorAll('.faq-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            });
        });
    }

    /**
     * Melhora a animação dos acordeões com efeitos visuais
     */
    function enhanceAccordionAnimations() {
        const accordionButtons = document.querySelectorAll('.accordion-button');
        accordionButtons.forEach(button => {
            button.addEventListener('click', function () {
                setTimeout(() => {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    if (isExpanded) {
                        const collapseElement = this.closest('.accordion-header').nextElementSibling;
                        if (collapseElement) {
                            collapseElement.querySelector('.accordion-body')
                                         .classList.add('animate__animated', 'animate__fadeIn');
                        }
                    }
                }, 100);
            });
        });
    }

    // =============================================================================
    // FUNCIONALIDADES DE PESQUISA E DESTAQUE
    // =============================================================================
    
    /**
     * Destaca termos pesquisados no conteúdo das FAQs
     */
    function highlightSearchTerms() {
        const searchTerm = '{{ termo_pesquisa }}';
        if (searchTerm && searchTerm.length > 2) {
            
            // Destacar no conteúdo das respostas
            const accordionItems = document.querySelectorAll('.accordion-body');
            accordionItems.forEach(item => {
                const content = item.innerHTML;
                const highlightedContent = content.replace(
                    new RegExp(searchTerm, 'gi'),
                    match => `<mark class="bg-warning">${match}</mark>`
                );
                item.innerHTML = highlightedContent;
            });

            // Destacar nas perguntas
            const accordionButtons = document.querySelectorAll('.accordion-button');
            accordionButtons.forEach(button => {
                const content = button.innerHTML;
                const highlightedContent = content.replace(
                    new RegExp(searchTerm, 'gi'),
                    match => `<mark class="bg-warning">${match}</mark>`
                );
                button.innerHTML = highlightedContent;
            });

            // Expandir automaticamente acordeões que contêm o termo pesquisado
            document.querySelectorAll('.accordion-button mark').forEach(mark => {
                const button = mark.closest('.accordion-button');
                if (button && button.classList.contains('collapsed')) {
                    button.click();
                }
            });
        }
    }

    /**
     * Melhora a formatação do conteúdo das FAQs
     */
    function enhanceFAQContent() {
        document.querySelectorAll('.faq-content').forEach(content => {
            let html = content.innerHTML;
            
            // Estilizar listas
            if (html.includes('<ul>') || html.includes('<ol>')) {
                html = html.replace(/<ul>/g, '<ul class="faq-list">');
                html = html.replace(/<ol>/g, '<ol class="faq-list">');
            }
            
            // Destaque para texto em negrito
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong class="text-primary">$1</strong>');
            
            // Formatação de títulos
            html = html.replace(/^#\s(.*?)$/gm, '<h5 class="mt-3 mb-2 text-primary">$1</h5>');
            
            content.innerHTML = html;
        });
    }

    // =============================================================================
    // FUNCIONALIDADES DE SALVAMENTO DE FAQ (ATUALIZADO)
    // =============================================================================
    
    /**
     * Salva uma FAQ para o usuário logado
     * @param {number} faqId - ID da FAQ a ser salva
     * @param {HTMLElement} element - Elemento botão que foi clicado
     */
    function salvarFAQ(faqId, element) {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        fetch(`/salvar-faq/${faqId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Atualizar interface para estado "salvo"
                element.classList.remove('btn-outline-primary');
                element.classList.add('btn-primary');
                element.innerHTML = '<i class="fas fa-bookmark"></i>';
                element.setAttribute('onclick', `removerFAQ(${faqId}, this)`);
                
                // ATUALIZADO: Chamada para a nova função de toast
                showToast('Dúvida Salva!', 'A pergunta foi adicionada aos seus favoritos.', 'success');

            } else {
                showToast('Ops!', data.message || 'Ocorreu um erro ao salvar a dúvida.', 'error');
            }
        })
        .catch(error => {
            console.error('Erro ao salvar FAQ:', error);
            showToast('Erro de Rede', 'Não foi possível conectar ao servidor. Tente novamente.', 'error');
        });
    }

    /**
     * Remove uma FAQ salva do usuário
     * @param {number} faqId - ID da FAQ a ser removida
     * @param {HTMLElement} element - Elemento botão que foi clicado
     */
    function removerFAQ(faqId, element) {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        fetch(`/remover-faq/${faqId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Atualizar interface para estado "não salvo"
                element.classList.remove('btn-primary');
                element.classList.add('btn-outline-primary');
                element.innerHTML = '<i class="far fa-bookmark"></i>';
                element.setAttribute('onclick', `salvarFAQ(${faqId}, this)`);
                
                // ATUALIZADO: Chamada para a nova função de toast
                showToast('Dúvida Removida', 'A pergunta foi retirada da sua lista de favoritos.', 'info');

            } else {
                showToast('Ops!', data.message || 'Ocorreu um erro ao remover a dúvida.', 'error');
            }
        })
        .catch(error => {
            console.error('Erro ao remover FAQ:', error);
            showToast('Erro de Rede', 'Não foi possível conectar ao servidor. Tente novamente.', 'error');
        });
    }

    // =============================================================================
    // MODAL DE LOGIN MODERNO - VERSÃO SIMPLIFICADA
    // =============================================================================

    let loginModalInstance = null;

    function mostrarLoginAlert() {
        if (!loginModalInstance) {
            const modalElement = document.getElementById('loginModal');
            if (!modalElement) {
                mostrarLoginAlertFallback();
                return;
            }
            loginModalInstance = new bootstrap.Modal(modalElement, {
                backdrop: 'static',
                keyboard: true
            });
        }
        
        // Aplicar blur
        document.body.classList.add('modal-blur-active');
        
        // Mostrar modal
        loginModalInstance.show();
        
        // Configurar eventos
        document.getElementById('loginModal').addEventListener('hidden.bs.modal', function () {
            document.body.classList.remove('modal-blur-active');
        }, { once: true });
    }

    function mostrarLoginAlertFallback() {
        if (confirm('Você precisa estar logado para salvar FAQs.\n\nDeseja ir para a página de login?')) {
            window.location.href = '/login/';
        }
    }

    // Função melhorada para toast
    function showToast(type, message) {
        const toastElement = document.getElementById('toastMessage');
        const toastIcon = toastElement.querySelector('.toast-icon i');
        const toastTitle = toastElement.querySelector('.toast-title');
        const toastBody = toastElement.querySelector('.toast-body');
        
        // Remover classes anteriores
        toastElement.className = 'toast modern-toast';
        
        // Configurar por tipo
        const config = {
            success: { icon: 'fas fa-check-circle', title: 'Sucesso', class: 'toast-success' },
            error: { icon: 'fas fa-exclamation-circle', title: 'Erro', class: 'toast-error' },
            warning: { icon: 'fas fa-exclamation-triangle', title: 'Atenção', class: 'toast-warning' },
            info: { icon: 'fas fa-info-circle', title: 'Informação', class: 'toast-info' }
        };
        
        const typeConfig = config[type] || config.info;
        
        toastElement.classList.add(typeConfig.class);
        toastIcon.className = typeConfig.icon;
        toastTitle.textContent = typeConfig.title;
        toastBody.textContent = message;
        
        // Mostrar toast
        const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
        toast.show();
    }

    // =============================================================================
    // SISTEMA DE NOTIFICAÇÕES TOAST (VERSÃO ÚNICA E APRIMORADA)
    // =============================================================================
    
    /**
     * Exibe uma notificação toast moderna e customizada.
     * @param {string} title - O título da notificação.
     * @param {string} message - A mensagem principal.
     * @param {string} type - O tipo de notificação ('success', 'error', 'info', 'warning').
     */
    function showToast(title, message, type = 'info') {
        const toastElement = document.getElementById('notificationToast');
        if (!toastElement) {
            console.error("Elemento de Toast #notificationToast não encontrado!");
            return;
        }
        
        const toast = new bootstrap.Toast(toastElement, { delay: 5000 }); // 5 segundos

        const toastIconArea = toastElement.querySelector('.toast-icon-area');
        const toastIcon = toastElement.querySelector('#toastIcon');
        const toastTitle = toastElement.querySelector('#toastTitle');
        const toastBody = toastElement.querySelector('#toastBody');

        const configs = {
            success: { icon: 'fa-check-circle', colorClass: 'toast-success', defaultTitle: 'Sucesso!' },
            error: { icon: 'fa-times-circle', colorClass: 'toast-error', defaultTitle: 'Erro!' },
            info: { icon: 'fa-info-circle', colorClass: 'toast-info', defaultTitle: 'Informação' },
            warning: { icon: 'fa-exclamation-triangle', colorClass: 'toast-warning', defaultTitle: 'Atenção!' }
        };

        const config = configs[type] || configs.info;
        
        // Atualiza o conteúdo do toast
        toastTitle.textContent = title || config.defaultTitle;
        toastBody.textContent = message;
        
        // Atualiza ícone e classes de cor
        toastIcon.className = `fas ${config.icon}`;
        toastIconArea.className = 'toast-icon-area d-flex align-items-center justify-content-center';
        toastIconArea.classList.add(config.colorClass);

        // Adiciona classes de animação ao mostrar
        toastElement.classList.remove('hide');
        toastElement.classList.add('show', 'animate__animated', 'animate__fadeInRight');
        
        toast.show();

        // Limpa as classes de animação ao fechar para evitar piscadas
        toastElement.addEventListener('hidden.bs.modal', function () {
            toastElement.classList.remove('animate__animated', 'animate__fadeInRight');
        }, { once: true });
    }

    // =============================================================================
    // INICIALIZAÇÃO DA PÁGINA
    // =============================================================================
    
    /**
     * Inicializa todas as funcionalidades quando a página carrega
     */
    document.addEventListener('DOMContentLoaded', function () {
        // Inicializar funcionalidades principais
        initSmoothScrolling();
        enhanceAccordionAnimations();
        highlightSearchTerms();
        enhanceFAQContent();

        // Adicionar animações aos elementos FAQ
        document.querySelectorAll('.accordion-item').forEach((item, index) => {
            item.classList.add('animate__animated', 'animate__fadeInUp');
            item.style.animationDelay = `${index * 0.1}s`;
        });
    });
</script>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>
<style>
    /*
=============================================================================
|                                                                           |
|                     STYLESHEET DA PÁGINA DE DÚVIDAS (FAQ)                 |
|                                                                           |
=============================================================================
|
| ÍNDICE DE ESTILOS:
|
| 1. COMPONENTES DE FAQ (ACORDEÃO)
| 2. COMPONENTES DE NAVEGAÇÃO E DESTAQUE
| 3. COMPONENTE DE NOTIFICAÇÃO (TOAST MODERNO)
| 4. COMPONENTE DE MODAL (LOGIN)
| 5. ANIMAÇÕES GLOBAIS (@keyframes)
| 6. MEDIA QUERIES (Estilos Responsivos)
|
\*---------------------------------------------------------------------------*/

/*
=============================================================================
1. COMPONENTES DE FAQ (ACORDEÃO)
=============================================================================
*/

/* Container Geral do Item FAQ */
.accordion-item {
    margin-bottom: 1.5rem !important;
    border-radius: 15px !important;
    overflow: hidden;
    border: none !important;
    transition: all 0.4s ease;
}

.accordion-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(106, 62, 161, 0.1);
}

/* Botão da Pergunta (Header) */
.accordion-button {
    padding: 1.5rem 2rem;
    background-color: #fff;
    color: var(--gray-800);
    font-weight: 600;
    text-align: left;
    box-shadow: none;
    transition: all 0.4s ease;
    position: relative;
}

.accordion-button:not(.collapsed) {
    background: linear-gradient(135deg, var(--primary-very-light) 0%, rgba(255, 255, 255, 0.95) 100%);
    color: var(--primary-dark);
    box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.02);
}

.accordion-button:focus {
    box-shadow: 0 0 0 2px rgba(106, 62, 161, 0.1);
    border-color: transparent;
}

/* Indicador de seta do Bootstrap */
.accordion-button::after {
    transition: all 0.3s ease;
}

.accordion-button:not(.collapsed)::after {
    color: var(--primary);
    transform: rotate(-180deg) scale(1.1);
}

/* Corpo da Resposta (Body) */
.accordion-body {
    padding: 1rem 2rem 2rem 2rem;
    background-color: #fff;
    color: var(--gray-700);
    font-size: 1.05rem;
    line-height: 1.8;
}

.accordion-body p {
    margin-bottom: 1.2rem;
}

.accordion-body p:last-child {
    margin-bottom: 0;
}

.accordion-body strong {
    color: var(--primary-dark);
    font-weight: 600;
}

.accordion-body a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
}

.accordion-body a:hover {
    text-decoration: underline;
}

/* Listas customizadas dentro das respostas */
.faq-list {
    background-color: var(--primary-very-light);
    border-left: 3px solid var(--primary);
    border-radius: 0 10px 10px 0;
    padding: 1.2rem 1.2rem 1.2rem 1.5rem;
    margin: 1rem 0;
}

.faq-list li {
    padding: 0.3rem 0;
}

/* Botão de Salvar FAQ */
.faq-save-button .btn-icon {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.faq-save-button .btn-icon:hover {
    transform: scale(1.1);
    background-color: rgba(106, 62, 161, 0.1);
}

/* Animação para o corpo do accordion */
.accordion-body.animate__fadeIn {
    animation-duration: 0.6s;
}

/* ==================================
   ESTILO ELEGANTE PARA FONTE DA FAQ
   ================================== */
.faq-source {
    border-top: 1px solid #e9ecef;
    padding-top: 1rem;
    margin-top: 1.5rem;
}

.faq-source-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 25px;
    color: var(--gray-700);
    font-size: 0.85rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

.faq-source-link:hover {
    background: linear-gradient(135deg, var(--primary-very-light) 0%, #e8e0ff 100%);
    color: var(--primary-dark);
    border-color: rgba(106, 62, 161, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(106, 62, 161, 0.15);
    text-decoration: none;
}

.faq-source-link i {
    font-size: 0.9rem;
    transition: transform 0.3s ease;
}

.faq-source-link:hover i {
    transform: scale(1.1);
}

/*
=============================================================================
2. COMPONENTES DE NAVEGAÇÃO E DESTAQUE
=============================================================================
*/

/* Abas de Navegação por Categoria */
.faq-nav .btn {
    border-radius: 30px;
    margin: 4px;
    font-size: 0.9rem;
    padding: 0.6rem 1.5rem;
    box-shadow: 0 5px 10px rgba(106, 62, 161, 0.08);
    transition: all 0.4s ease;
}

.faq-nav .btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 15px rgba(106, 62, 161, 0.15);
}

/* Ícones de Categoria */
.feature-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
    color: var(--primary);
    background: linear-gradient(135deg, rgba(106, 62, 161, 0.1), rgba(154, 109, 215, 0.1));
    border-radius: 50%;
}

/*
=============================================================================
3. COMPONENTE DE NOTIFICAÇÃO (TOAST MODERNO - VERSÃO APRIMORADA)
=============================================================================
*/

/* Container para garantir que o toast fique sobre todos os elementos */
.toast-container {
    z-index: 9999 !important;
}

/* Corpo do Toast Moderno */
.modern-toast {
    width: 380px;
    max-width: 95%;
    background-color: #fff;
    border-radius: 15px; /* Borda mais suave */
    border: none;
    box-shadow: 0 15px 40px -10px rgba(0, 0, 0, 0.2); /* Sombra 3D */
    overflow: hidden;
    /* Borda inferior sutil para reforçar a cor do status */
    border-bottom: 4px solid transparent; 
    transition: all 0.4s ease-in-out;
}

/* Variações de cor da borda inferior */
.modern-toast .toast-success { border-bottom-color: #28a745; }
.modern-toast .toast-error { border-bottom-color: #dc3545; }
.modern-toast .toast-info { border-bottom-color: #0dcaf0; }
.modern-toast .toast-warning { border-bottom-color: #ffc107; }

.toast-body {
    padding: 0 !important; /* Reset do padding padrão */
}

/* Área do Ícone Colorida */
.toast-icon-area {
    flex: 0 0 60px; /* Espaço maior para o ícone */
    color: #fff;
    font-size: 1.8rem; /* Ícone maior */
    transition: background-color 0.3s ease;
    border-top-left-radius: 12px;
}

/* Variações de Cor com Gradiente para a Área do Ícone */
.toast-icon-area.toast-success { background: linear-gradient(135deg, #28a745, #218838); }
.toast-icon-area.toast-error { background: linear-gradient(135deg, #dc3545, #c82333); }
.toast-icon-area.toast-info { background: linear-gradient(135deg, #17a2b8, #138496); }
.toast-icon-area.toast-warning { background: linear-gradient(135deg, #ffc107, #e0a800); }

/* Área de Conteúdo do Toast */
.toast-content-area {
    flex-grow: 1;
    padding: 1rem 1.2rem; /* Espaçamento interno confortável */
}

.toast-title {
    font-weight: 700;
    font-size: 1.1rem; /* Título em destaque */
    color: #343a40;
    margin-bottom: 0.25rem;
}

.toast-message {
    font-size: 0.95rem; /* Mensagem clara e legível */
    color: #6c757d;
    line-height: 1.5;
}

/* Botão de Fechar Moderno */
.btn-close-toast {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: #adb5bd;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.btn-close-toast:hover {
    background-color: #f1f3f5;
    color: #495057;
    transform: rotate(90deg) scale(1.1);
}

/*
=============================================================================
4. COMPONENTE DE MODAL (LOGIN)
=============================================================================
*/

/* Modal Backdrop */
.modal-backdrop.show {
    backdrop-filter: blur(10px);
    background-color: rgba(0, 0, 0, 0.3);
}

/* Modal Dialog */
.login-modal .modal-dialog {
    max-width: 440px;
    margin: 1rem auto;
}

.login-modal-content {
    border: 2px solid #ccc;
    border-radius: 24px;
    box-shadow: var(--shadow-modern);
    background: white;
    overflow: hidden;
}

/* Modal Header */
.login-modal .modal-header {
    position: relative;
    padding: 1rem 1rem 0;
}

.btn-close-modern {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.btn-close-modern:hover {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    transform: rotate(90deg);
}

/* Login Icon */
.login-icon-wrapper {
    position: relative;
}

.login-icon {
    width: 70px;
    height: 70px;
    background: var(--gradient-modern);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    animation: pulse-modern 2s infinite;
}

.login-icon i {
    font-size: 1.8rem;
    color: white;
}

/* Login Content */
.login-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.login-description {
    font-size: 1rem;
    color: #6c757d;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

/* Benefits List */
.benefits-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-bottom: 2rem;
}

.benefit-item {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.5rem 1rem;
    background: rgba(106, 62, 161, 0.05);
    border-radius: 16px;
    transition: all 0.3s ease;
}

.benefit-item:hover {
    background: rgba(106, 62, 161, 0.1);
    transform: translateX(5px);
}

.benefit-item i {
    color: var(--primary);
    margin-right: 12px;
    width: 16px;
    font-size: 0.9rem;
}

.benefit-item span {
    font-size: 0.9rem;
    color: #495057;
    font-weight: 500;
}

/* Login Footer */
.login-footer {
    border-top: 1px solid #e9ecef;
    padding-top: 1rem;
}

.btn-link-modern {
    background: none;
    border: none;
    color: #6c757d;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0.5rem 1rem;
    border-radius: 30px;
}

.btn-link-modern:hover {
    color: var(--primary);
    background: rgba(106, 62, 161, 0.05);
}

/*
=============================================================================
5. ANIMAÇÕES GLOBAIS (@keyframes)
=============================================================================
*/

@keyframes pulse-modern {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

/*
=============================================================================
6. MEDIA QUERIES (Estilos Responsivos)
=============================================================================
*/

/* Tablets */
@media (max-width: 768px) {
    .accordion-button {
        padding: 1.2rem 1.5rem;
        font-size: 1rem;
    }
    
    .accordion-body {
        padding: 1.5rem;
        font-size: 1rem;
    }
    
    .feature-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        margin-bottom: 1rem;
    }
}

/* Mobile */
@media (max-width: 576px) {
    .login-modal .modal-dialog {
        margin: 1rem;
        max-width: none;
    }
    
    .modal-body {
        padding: 1.5rem !important;
    }
    
    .login-icon {
        width: 60px;
        height: 60px;
    }
    
    .login-icon i {
        font-size: 1.5rem;
    }
    
    .login-title {
        font-size: 1.3rem;
    }
    
    .login-description {
        font-size: 0.9rem;
    }
    
    .benefit-item {
        padding: 0.4rem 0.8rem;
    }
    
    .benefit-item span {
        font-size: 0.85rem;
    }
    
    .btn-login, .btn-register {
        padding: 10px 20px;
        font-size: 0.9rem;
    }
}

/*
=============================================================================
8. CORREÇÃO PARA PAGINAÇÃO (VERSÃO REVISADA E CORRIGIDA)
=============================================================================
*/

/* Container principal da paginação */
.pagination {
    display: flex;
    flex-wrap: wrap; /* Permite que os botões quebrem a linha */
    justify-content: center;
    gap: 12px; /* Um pouco mais de espaço */
}

/* Removemos as margens padrão do Bootstrap */
.pagination .page-item {
    margin: 0 !important;
}

/* --- A. Estilo para botões NUMÉRICOS (circulares) --- */
/* Usamos :not() para aplicar este estilo APENAS se o item NÃO for da paginação principal */
.pagination .page-item:not(.main-pagination-item) .page-link {
    border-radius: 50%;
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

/* Hover para botões circulares */
.pagination .page-item:not(.main-pagination-item):not(.active):not(.disabled) .page-link:hover {
    transform: translateY(-3px);
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.15);
}

/* Ativo para botões circulares */
.pagination .page-item:not(.main-pagination-item).active .page-link {
    transform: scale(1.05);
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.3);
}

/* --- B. Estilo para paginação PRINCIPAL de texto (pílulas) --- */

/* Estilo base que ANULA os estilos circulares */
.main-pagination-item .page-link {
    /* Anulação de propriedades conflitantes */
    width: auto;
    height: auto;
    display: inline-block; /* Comportamento de botão normal */

    /* Estilos de pílula */
    border-radius: 50px;
    padding: 0.6rem 1.5rem;
    white-space: nowrap;
    font-weight: 500;
    border: 2px solid #e9ecef;
    color: var(--primary);
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: background-color 0.2s ease-out, color 0.2s ease-out, border-color 0.2s ease-out, box-shadow 0.2s ease-out;
}

/* Efeito de hover para pílulas */
.page-item.main-pagination-item:not(.active):not(.disabled) .page-link:hover {
    transform: translateY(-2px); /* Efeito mais sutil */
    border-color: var(--primary);
    background-color: var(--primary);
    color: #fff;
    box-shadow: 0 5px 15px rgba(106, 62, 161, 0.2);
}

/* Estilo ATIVO para pílulas */
.main-pagination-item.active .page-link {
    background: linear-gradient(45deg, var(--primary), var(--primary-light));
    color: #fff;
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(106, 62, 161, 0.25);
    transform: none; /* Garante que não há escala */
}

/* Estilo DESABILITADO (para "Página X de Y") */
.main-pagination-item.disabled .page-link {
    background-color: #f8f9fa;
    color: #adb5bd;
    border-color: #e9ecef;
    box-shadow: none;
    cursor: not-allowed;
    transform: none;
}

/*
=============================================================================
9. AJUSTES RESPONSIVOS PARA PAGINAÇÃO (VERSÃO FINAL CORRIGIDA)
=============================================================================
*/
@media (max-width: 576px) {

    /* --- AJUSTES PARA A PAGINAÇÃO DE TEXTO (PÍLULAS) --- */
    /*
     * A MUDANÇA PRINCIPAL ESTÁ AQUI:
     * Usamos o seletor :has() para aplicar o empilhamento SOMENTE
     * ao container .pagination que CONTÉM um item com a classe .main-pagination-item.
     * Isso impede que a paginação numérica seja afetada.
    */
    .pagination:has(.main-pagination-item) {
        flex-direction: column;   /* Empilha os itens verticalmente */
        align-items: center;      /* Centraliza os botões */
        gap: 15px;                /* Espaçamento entre os botões empilhados */
    }

    /* As regras abaixo agora só se aplicam à paginação de texto, graças ao seletor acima */
    .pagination:has(.main-pagination-item) .main-pagination-item {
      width: 90%;
      max-width: 300px;
    }

    .pagination:has(.main-pagination-item) .main-pagination-item .page-link {
      display: block;
      text-align: center;
      width: 100%;
    }


    /* --- AJUSTES PARA A PAGINAÇÃO NUMÉRICA (CÍRCULOS) --- */
    /*
     * Para a paginação numérica, apenas reduzimos um pouco o tamanho
     * para economizar espaço, mas ela continuará na horizontal.
    */
    .pagination .page-item:not(.main-pagination-item) .page-link {
        width: 38px;
        height: 38px;
        font-size: 0.9rem;
    }
}
</style>
{% endblock %}